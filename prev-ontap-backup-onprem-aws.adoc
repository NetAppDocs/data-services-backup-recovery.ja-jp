---
sidebar: sidebar 
permalink: prev-ontap-backup-onprem-aws.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, NetApp Backup and Recovery, Oracle database, Microsoft SQL Server database, SAP HANA database 
summary: NetApp NetApp Backup and Recoveryを使用して VMware ワークロードを保護します。 
---
= NetApp Backup and Recoveryを使用してオンプレミスのONTAPデータを Amazon S3 にバックアップする
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
NetApp Backup and Recoveryでいくつかの手順を完了して、オンプレミスのONTAPシステムからセカンダリ ストレージ システムと Amazon S3 クラウド ストレージへのボリューム データのバックアップを開始します。


NOTE: 「オンプレミスのONTAPシステム」には、 FAS、 AFF、およびONTAP Selectシステムが含まれます。

[]
====
*注意* NetApp Backup and Recoveryのワークロードを切り替えるには、link:br-start-switch-ui.html["さまざまなNetApp Backup and Recoveryワークロードに切り替える"] 。

====


== 接続方法を特定する

オンプレミスのONTAPシステムから AWS S3 へのバックアップを構成するときに使用する 2 つの接続方法のうちどちらを選択します。

* *パブリック接続* - パブリック S3 エンドポイントを使用して、 ONTAPシステムを AWS S3 に直接接続します。
* *プライベート接続* - VPN または AWS Direct Connect を使用し、プライベート IP アドレスを使用する VPC エンドポイント インターフェイスを介してトラフィックをルーティングします。


オプションとして、パブリック接続またはプライベート接続を使用して、複製されたボリュームのセカンダリONTAPシステムに接続することもできます。

次の図は、*パブリック接続*方式と、コンポーネント間で準備する必要がある接続を示しています。オンプレミスにインストールしたコンソールエージェント、または AWS VPC にデプロイしたコンソールエージェントを使用できます。

image:diagram_cloud_backup_onprem_aws_public.png["NetApp Backup and Recovery がパブリック接続を介して、クラスター上のボリュームおよびバックアップ ファイルが保存されている AWS S3 ストレージと通信する方法を示す図。"]

次の図は、*プライベート接続*方式と、コンポーネント間で準備する必要がある接続を示しています。オンプレミスにインストールしたコンソールエージェント、または AWS VPC にデプロイしたコンソールエージェントを使用できます。

image:diagram_cloud_backup_onprem_aws_private.png["NetApp Backup and Recovery が、プライベート接続を介してクラスター上のボリュームおよびバックアップ ファイルが保存されている AWS S3 ストレージと通信する方法を示す図。"]



== コンソールエージェントを準備する

コンソール エージェントは、 NetApp Console機能のメイン ソフトウェアです。  ONTAPデータをバックアップおよび復元するには、コンソール エージェントが必要です。



=== コンソールエージェントの作成または切り替え

AWS VPC またはオンプレミスにコンソールエージェントがすでにデプロイされている場合は、準備は完了です。

そうでない場合は、 ONTAPデータを AWS S3 ストレージにバックアップするために、これらの場所のいずれかにコンソールエージェントを作成する必要があります。別のクラウド プロバイダーにデプロイされたコンソール エージェントは使用できません。

* https://docs.netapp.com/us-en/console-setup-admin/concept-connectors.html["コンソールエージェントについて学ぶ"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-connector-aws.html["AWSにコンソールエージェントをインストールする"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-connector-on-prem.html["オンプレミスにコンソールエージェントをインストールする"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-install-restricted-mode.html["AWS GovCloud リージョンにコンソールエージェントをインストールする"^]
+
NetApp Backup and Recovery は、コンソール エージェントがオンプレミスでインストールされている場合ではなく、クラウドに展開されている場合に、GovCloud リージョンでサポートされます。さらに、AWS Marketplace からコンソールエージェントをデプロイする必要があります。  NetApp Console SaaS Web サイトからコンソール エージェントを政府地域に展開することはできません。





=== コンソールエージェントのネットワーク要件を準備する

次のネットワーク要件が満たされていることを確認してください。

* コンソール エージェントがインストールされているネットワークで次の接続が有効になっていることを確認します。
+
** ポート443経由のNetApp Backup and RecoveryおよびS3オブジェクトストレージへのHTTPS接続(https://docs.netapp.com/us-en/console-setup-admin/task-set-up-networking-aws.html#endpoints-contacted-for-day-to-day-operations["エンドポイントのリストを見る"^]）
** ポート443経由のONTAPクラスタ管理LIFへのHTTPS接続
** AWS および AWS GovCloud のデプロイメントには、追加の受信および送信セキュリティ グループ ルールが必要です。見る https://docs.netapp.com/us-en/console-setup-admin/reference-ports-aws.html["AWS のコンソールエージェントのルール"^]詳細については。


* ONTAPクラスターから VPC への Direct Connect または VPN 接続があり、コンソール エージェントと S3 間の通信を AWS 内部ネットワーク (プライベート接続) 内に維持したい場合は、S3 への VPC エンドポイント インターフェイスを有効にする必要があります。<<VPC エンドポイント インターフェースを使用してシステムをプライベート接続用に設定する>>。




== ライセンス要件を確認する

AWS とNetApp Consoleの両方のライセンス要件を確認する必要があります。

* クラスターでNetApp Backup and Recoveryを有効にする前に、AWS の従量課金制 (PAYGO) NetApp Console Marketplace オファリングに登録するか、 NetAppからNetApp Backup and Recovery BYOL ライセンスを購入して有効にする必要があります。これらのライセンスはあなたのアカウント用であり、複数のシステムで使用できます。
+
** NetApp Backup and Recovery PAYGOライセンスの場合は、 https://aws.amazon.com/marketplace/pp/prodview-oorxakq6lq7m4?sr=0-8&ref_=beagle&applicationId=AWSMPContessa["AWS Marketplace からのNetApp Consoleの提供"^] 。  NetApp Backup and Recoveryの課金は、このサブスクリプションを通じて行われます。
** NetApp Backup and Recovery BYOL ライセンスの場合、ライセンスの有効期間と容量にわたってサービスを使用できるようにするNetAppからのシリアル番号が必要になります。


* バックアップが保存されるオブジェクト ストレージ スペース用の AWS サブスクリプションが必要です。


*サポート対象地域*

AWS GovCloud リージョンを含むすべてのリージョンで、オンプレミスシステムから Amazon S3 へのバックアップを作成できます。サービスを設定するときに、バックアップを保存するリージョンを指定します。



== ONTAPクラスタを準備する

ソースのオンプレミスONTAPシステムと、セカンダリのオンプレミスONTAPまたはCloud Volumes ONTAPシステムを準備する必要があります。

ONTAPクラスタを準備するには、次の手順を実行します。

* NetApp ConsoleでONTAPシステムを検出する
* ONTAPのシステム要件を確認する
* オブジェクトストレージにデータをバックアップするためのONTAPネットワーク要件を確認する
* ボリュームを複製するためのONTAPネットワーク要件を確認する




=== NetApp ConsoleでONTAPシステムを検出する

ソースのオンプレミスONTAPシステムとセカンダリのオンプレミスONTAPまたはCloud Volumes ONTAPシステムの両方が、 NetApp Consoleの*システム* ページで利用できる必要があります。

クラスターを追加するには、クラスター管理 IP アドレスと管理者ユーザー アカウントのパスワードを知っておく必要があります。https://docs.netapp.com/us-en/storage-management-ontap-onprem/task-discovering-ontap.html["クラスターの検出方法を学ぶ"^]。



=== ONTAPのシステム要件を確認する

次のONTAP要件が満たされていることを確認します。

* 最低でもONTAP 9.8、 ONTAP 9.8P13 以降が推奨されます。
* SnapMirrorライセンス (プレミアム バンドルまたはデータ保護バンドルの一部として含まれています)。
+
*注:* NetApp Backup and Recoveryを使用する場合、「Hybrid Cloud Bundle」は必要ありません。

+
方法を学ぶ https://docs.netapp.com/us-en/ontap/system-admin/manage-licenses-concept.html["クラスターライセンスを管理する"^]。

* 時間とタイムゾーンは正しく設定されています。方法を学ぶ https://docs.netapp.com/us-en/ontap/system-admin/manage-cluster-time-concept.html["クラスター時間を設定する"^]。
* データをレプリケートする場合は、データをレプリケートする前に、ソース システムとデスティネーション システムで互換性のあるONTAPバージョンが実行されていることを確認する必要があります。
+
https://docs.netapp.com/us-en/ontap/data-protection/compatible-ontap-versions-snapmirror-concept.html["SnapMirror関係に互換性のあるONTAPバージョンを表示する"^]。





=== オブジェクトストレージにデータをバックアップするためのONTAPネットワーク要件を確認する

オブジェクト ストレージに接続するシステムでは、次の要件を構成する必要があります。

* ファンアウト バックアップ アーキテクチャの場合は、_プライマリ_ システムで次の設定を構成します。
* カスケード バックアップ アーキテクチャの場合は、セカンダリ システムで次の設定を構成します。


次のONTAPクラスタ ネットワーク要件が必要です。

* クラスタでは、コンソール エージェントからクラスタ管理 LIF への受信 HTTPS 接続が必要です。
* バックアップするボリュームをホストする各ONTAPノードには、クラスタ間 LIF が必要です。これらのクラスタ間 LIF はオブジェクト ストアにアクセスできる必要があります。
+
クラスターは、バックアップおよび復元操作のために、クラスター間 LIF から Amazon S3 ストレージへのポート 443 経由の送信 HTTPS 接続を開始します。ONTAP はオブジェクト ストレージとの間でデータの読み取りと書き込みを行います。オブジェクト ストレージは開始することはなく、応答するだけです。

* クラスタ間 LIF は、 ONTAP がオブジェクト ストレージに接続するために使用する _IPspace_ に関連付ける必要があります。 https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["IPspacesについて詳しくはこちら"^] 。
+
NetApp Backup and Recoveryをセットアップするときに、使用する IPspace の入力を求められます。これらの LIF が関連付けられている IPspace を選択する必要があります。これは、「デフォルト」の IPspace の場合もあれば、作成したカスタム IPspace の場合もあります。

+
「デフォルト」とは異なる IPspace を使用している場合は、オブジェクト ストレージにアクセスするために静的ルートを作成する必要がある場合があります。

+
IPspace 内のすべてのクラスタ間 LIF はオブジェクト ストアにアクセスできる必要があります。現在の IPspace に対してこれを構成できない場合は、すべてのクラスタ間 LIF がオブジェクト ストアにアクセスできる専用の IPspace を作成する必要があります。

* ボリュームが配置されているストレージ VM に対して DNS サーバーが設定されている必要があります。方法を見る https://docs.netapp.com/us-en/ontap/networking/configure_dns_services_auto.html["SVMのDNSサービスを構成する"^]。
* 必要に応じてファイアウォール ルールを更新し、 ONTAPからオブジェクト ストレージへのポート 443 経由のNetApp Backup and Recovery接続と、ストレージ VM から DNS サーバーへのポート 53 (TCP/UDP) 経由の名前解決トラフィックを許可します。
* S3 接続に AWS のプライベート VPC インターフェイス エンドポイントを使用している場合は、HTTPS/443 を使用するために、S3 エンドポイント証明書をONTAPクラスターにロードする必要があります。<<VPC エンドポイント インターフェースを使用してシステムをプライベート接続用に設定する>>。  *[ ONTAPクラスターに S3 バケットにアクセスする権限があることを確認します。




=== ボリュームを複製するためのONTAPネットワーク要件を確認する

NetApp Backup and Recoveryを使用してセカンダリONTAPシステムに複製ボリュームを作成する場合は、ソース システムと宛先システムが次のネットワーク要件を満たしていることを確認してください。



==== オンプレミスのONTAPネットワーク要件

* クラスターが社内にある場合は、企業ネットワークからクラウド プロバイダーの仮想ネットワークへの接続が必要です。これは通常、VPN 接続です。
* ONTAPクラスタは、追加のサブネット、ポート、ファイアウォール、およびクラスタの要件を満たす必要があります。
+
Cloud Volumes ONTAPまたはオンプレミス システムにレプリケートできるため、オンプレミスONTAPシステムのピアリング要件を確認してください。 https://docs.netapp.com/us-en/ontap-sm-classic/peering/reference_prerequisites_for_cluster_peering.html["ONTAPドキュメントでクラスタピアリングの前提条件を確認する"^] 。





==== Cloud Volumes ONTAPのネットワーク要件

* インスタンスのセキュリティ グループには、必要な受信ルールと送信ルール (具体的には、ICMP とポート 11104 および 11105 のルール) が含まれている必要があります。これらのルールは、事前定義されたセキュリティ グループに含まれています。




== Amazon S3をバックアップターゲットとして準備する

Amazon S3 をバックアップターゲットとして準備するには、次の手順を実行します。

* S3 権限を設定します。
* (オプション) 独自の S3 バケットを作成します。  (必要に応じて、サービスによってバケットが作成されます。)
* (オプション) データ暗号化用にカスタマー管理の AWS キーを設定します。
* (オプション) VPC エンドポイント インターフェイスを使用して、システムをプライベート接続用に設定します。




=== S3の権限を設定する

次の 2 セットの権限を構成する必要があります。

* コンソール エージェントが S3 バケットを作成および管理するための権限。
* オンプレミスのONTAPクラスターが S3 バケットのデータの読み取りと書き込みを行えるようにするための権限。


.手順
. コンソール エージェントに必要な権限があることを確認します。詳細については、 https://docs.netapp.com/us-en/console-setup-admin/reference-permissions-aws.html["NetApp Consoleポリシー権限"^] 。
+

NOTE: AWS中国リージョンでバックアップを作成する場合、IAMポリシーのすべての_Resource_セクションのAWSリソース名「arn」を「aws」から「aws-cn」に変更する必要があります。例： `arn:aws-cn:s3:::netapp-backup-*` 。

. サービスをアクティブ化すると、バックアップ ウィザードによってアクセス キーとシークレット キーの入力が求められます。これらの認証情報はONTAPクラスターに渡され、 ONTAP はS3 バケットにデータをバックアップおよび復元できるようになります。そのためには、次の権限を持つ IAM ユーザーを作成する必要があります。
+
参照 https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html["AWS ドキュメント: IAM ユーザーに権限を委任するロールの作成"^]。

+
[%collapsible]
====
[source, json]
----
{
    "Version": "2012-10-17",
     "Statement": [
        {
           "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:ListBucket",
                "s3:ListAllMyBuckets",
                "s3:GetBucketLocation",
                "s3:PutEncryptionConfiguration"
            ],
            "Resource": "arn:aws:s3:::netapp-backup-*",
            "Effect": "Allow",
            "Sid": "backupPolicy"
        },
        {
            "Action": [
                "s3:ListBucket",
                "s3:GetBucketLocation"
            ],
            "Resource": "arn:aws:s3:::netapp-backup*",
            "Effect": "Allow"
        },
        {
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:ListAllMyBuckets",
                "s3:PutObjectTagging",
                "s3:GetObjectTagging",
                "s3:RestoreObject",
                "s3:GetBucketObjectLockConfiguration",
                "s3:GetObjectRetention",
                "s3:PutBucketObjectLockConfiguration",
                "s3:PutObjectRetention"
            ],
            "Resource": "arn:aws:s3:::netapp-backup*/*",
            "Effect": "Allow"
        }
    ]
}
----
====




=== 独自のバケットを作成する

デフォルトでは、サービスによってバケットが作成されます。または、独自のバケットを使用する場合は、バックアップ アクティベーション ウィザードを開始する前にバケットを作成し、ウィザードでそれらのバケットを選択できます。

link:prev-ontap-protect-journey.html["独自のバケットの作成について詳しくは"^]。

独自のバケットを作成する場合は、「netapp-backup」というバケット名を使用する必要があります。カスタム名を使用する必要がある場合は、 `ontapcloud-instance-policy-netapp-backup`既存の CVO の IAMRole を作成し、次のリストを S3 権限に追加します。含める必要がある `"Resource": "arn:aws:s3:::*"`バケットに関連付ける必要のあるすべての必要な権限を割り当てます。

[%collapsible]
====
"アクション": [ "S3:ListBucket" "S3:GetBucketLocation" ] "リソース": "arn:aws:s3:::*", "効果": "許可" }, { "アクション": [ "S3:GetObject", "S3:PutObject", "S3:DeleteObject", "S3:ListAllMyBuckets", "S3:PutObjectTagging", "S3:GetObjectTagging", "S3:RestoreObject", "S3:GetBucketObjectLockConfiguration", "S3:GetObjectRetention", "S3:PutBucketObjectLockConfiguration", "S3:PutObjectRetention" ] "リソース": "arn:aws:s3:::*",

====


=== データ暗号化用の顧客管理 AWS キーを設定する

デフォルトの Amazon S3 暗号化キーを使用してオンプレミスのクラスターと S3 バケット間で渡されるデータを暗号化する場合は、デフォルトのインストールでそのタイプの暗号化が使用されるため、すべて準備完了です。

代わりに、デフォルトのキーではなく、独自の顧客管理キーを使用してデータを暗号化する場合は、 NetApp Backup and Recoveryウィザードを開始する前に、暗号化管理キーを事前に設定しておく必要があります。

https://docs.netapp.com/us-en/storage-management-cloud-volumes-ontap/task-setting-up-kms.html["Cloud Volumes ONTAPで独自のAmazon暗号化キーを使用する方法を参照してください。"^]。

https://docs.netapp.com/us-en/console-setup-admin/task-install-connector-aws-bluexp.html#configure-encryption-settings["NetApp Backup and Recoveryで独自のAmazon暗号化キーを使用する方法を参照してください。"^]。



=== VPC エンドポイント インターフェースを使用してシステムをプライベート接続用に設定する

標準のパブリック インターネット接続を使用する場合は、すべての権限がコンソール エージェントによって設定されるため、他に何もする必要はありません。

オンプレミスのデータセンターから VPC へのインターネット経由のより安全な接続を確立したい場合は、バックアップアクティベーションウィザードで AWS PrivateLink 接続を選択するオプションがあります。プライベート IP アドレスを使用する VPC エンドポイント インターフェイスを介してオンプレミス システムに接続するために VPN または AWS Direct Connect を使用する予定の場合は、これが必要です。

.手順
. Amazon VPC コンソールまたはコマンドラインを使用して、インターフェイスエンドポイント設定を作成します。 https://docs.aws.amazon.com/AmazonS3/latest/userguide/privatelink-interface-endpoints.html["Amazon S3 の AWS PrivateLink の使用に関する詳細については、こちらをご覧ください。"^] 。
. コンソール エージェントに関連付けられているセキュリティ グループ構成を変更します。ポリシーを「カスタム」（「フルアクセス」から）に変更し、<<S3の権限を設定する,バックアップポリシーからS3権限を追加する>>先に示したとおりです。
+
プライベート エンドポイントへの通信にポート 80 (HTTP) を使用している場合は、設定は完了です。これで、クラスター上でNetApp Backup and Recoveryを有効にできるようになりました。

+
プライベート エンドポイントへの通信にポート 443 (HTTPS) を使用している場合は、次の 4 つの手順に示すように、VPC S3 エンドポイントから証明書をコピーし、 ONTAPクラスターに追加する必要があります。

. AWS コンソールからエンドポイントの DNS 名を取得します。
. VPC S3 エンドポイントから証明書を取得します。これを実行するには https://docs.netapp.com/us-en/console-setup-admin/task-maintain-connectors.html#connect-to-the-linux-vm["コンソールエージェントをホストするVMにログインする"^]次のコマンドを実行します。エンドポイントの DNS 名を入力するときは、先頭に「*」を置き換えて「bucket」を追加します。
+
[source, text]
----
[ec2-user@ip-10-160-4-68 ~]$ openssl s_client -connect bucket.vpce-0ff5c15df7e00fbab-yxs7lt8v.s3.us-west-2.vpce.amazonaws.com:443 -showcerts
----
. このコマンドの出力から、S3 証明書のデータ (BEGIN / END CERTIFICATE タグを含む、その間のすべてのデータ) をコピーします。
+
[source, text]
----
Certificate chain
0 s:/CN=s3.us-west-2.amazonaws.com`
   i:/C=US/O=Amazon/OU=Server CA 1B/CN=Amazon
-----BEGIN CERTIFICATE-----
MIIM6zCCC9OgAwIBAgIQA7MGJ4FaDBR8uL0KR3oltTANBgkqhkiG9w0BAQsFADBG
…
…
GqvbOz/oO2NWLLFCqI+xmkLcMiPrZy+/6Af+HH2mLCM4EsI2b+IpBmPkriWnnxo=
-----END CERTIFICATE-----
----
. ONTAPクラスタ CLI にログインし、次のコマンドを使用してコピーした証明書を適用します (独自のストレージ VM 名に置き換えます)。
+
[source, text]
----
cluster1::> security certificate install -vserver cluster1 -type server-ca
Please enter Certificate: Press <Enter> when done
----




== ONTAPボリューム上のバックアップをアクティブ化する

オンプレミスのシステムからいつでも直接バックアップをアクティブ化できます。

ウィザードに従って、次の主要な手順を実行します。

* <<バックアップしたいボリュームを選択します>>
* <<バックアップ戦略を定義する>>
* <<選択内容を確認する>>


また、<<APIコマンドを表示する>>レビュー ステップでコードをコピーして、将来のシステムのバックアップ アクティベーションを自動化できます。



=== ウィザードを起動する

.手順
. 次のいずれかの方法で、バックアップと回復のアクティブ化ウィザードにアクセスします。
+
** コンソールの *システム* ページで、システムを選択し、右側のパネルの [バックアップとリカバリ] の横にある *有効化 > バックアップ ボリューム* を選択します。
+
バックアップの Amazon S3 保存先がコンソールの *システム* ページにシステムとして存在する場合は、 ONTAPクラスターを Amazon S3 オブジェクトストレージにドラッグできます。

** バックアップとリカバリバーで*ボリューム*を選択します。ボリュームタブから*アクション*を選択しますimage:icon-action.png["アクションアイコン"]アイコンをクリックし、単一ボリューム（オブジェクト ストレージへのレプリケーションまたはバックアップがまだ有効になっていない）の [バックアップのアクティブ化]* を選択します。


+
ウィザードの「概要」ページには、ローカル スナップショット、レプリケーション、バックアップなどの保護オプションが表示されます。この手順で 2 番目のオプションを実行した場合、ボリュームが 1 つ選択された状態で「バックアップ戦略の定義」ページが表示されます。

. 次のオプションを続行します。
+
** コンソールエージェントがすでにある場合は、設定は完了です。  *次へ*を選択してください。
** コンソール エージェントがまだない場合は、[*コンソール エージェントの追加*] オプションが表示されます。参照<<コンソールエージェントを準備する>>。






=== バックアップしたいボリュームを選択します

保護するボリュームを選択します。保護されたボリュームとは、スナップショット ポリシー、レプリケーション ポリシー、オブジェクトへのバックアップ ポリシーの 1 つ以上を持つボリュームです。

FlexVolまたはFlexGroupボリュームを保護することを選択できますが、システムのバックアップをアクティブ化するときにこれらのボリュームを混在して選択することはできません。方法を見るlink:prev-ontap-backup-manage.html["システム内の追加ボリュームのバックアップを有効にする"](FlexVolまたはFlexGroup) 初期ボリュームのバックアップを構成した後。

[NOTE]
====
* 一度に 1 つのFlexGroupボリューム上でのみバックアップをアクティブ化できます。
* 選択するボリュームには同じSnapLock設定が必要です。すべてのボリュームでSnapLock Enterpriseを有効にするか、 SnapLock を無効にする必要があります。


====
.手順
選択したボリュームにスナップショットまたはレプリケーション ポリシーがすでに適用されている場合は、後で選択したポリシーによって既存のポリシーが上書きされます。

. 「ボリュームの選択」ページで、保護するボリュームを選択します。
+
** 必要に応じて、行をフィルタリングして、特定のボリューム タイプ、スタイルなどを持つボリュームのみを表示し、選択を容易にします。
** 最初のボリュームを選択したら、すべてのFlexVolボリュームを選択できます (FlexGroupボリュームは一度に 1 つだけ選択できます)。既存のFlexVolボリュームをすべてバックアップするには、まず 1 つのボリュームをチェックし、次にタイトル行のボックスをチェックします。
** 個々のボリュームをバックアップするには、各ボリュームのボックスをオンにします。


. *次へ*を選択します。




=== バックアップ戦略を定義する

バックアップ戦略を定義するには、次のオプションを設定する必要があります。

* ローカルスナップショット、レプリケーション、オブジェクトストレージへのバックアップなど、バックアップオプションのいずれかまたはすべてが必要な場合
* アーキテクチャ
* ローカルスナップショットポリシー
* レプリケーションターゲットとポリシー
+

NOTE: 選択したボリュームのスナップショットおよびレプリケーション ポリシーがこの手順で選択したポリシーと異なる場合、既存のポリシーが上書きされます。

* オブジェクト ストレージ情報へのバックアップ (プロバイダー、暗号化、ネットワーク、バックアップ ポリシー、エクスポート オプション)。


.手順
. 「バックアップ戦略の定義」ページで、次のいずれかまたはすべてを選択します。デフォルトでは 3 つすべてが選択されています。
+
** *ローカル スナップショット*: オブジェクト ストレージへのレプリケーションまたはバックアップを実行する場合は、ローカル スナップショットを作成する必要があります。
** *レプリケーション*: 別のONTAPストレージ システムに複製されたボリュームを作成します。
** *バックアップ*: ボリュームをオブジェクト ストレージにバックアップします。


. *アーキテクチャ*: レプリケーションとバックアップを選択した場合は、次のいずれかの情報フローを選択します。
+
** *カスケード*: 情報はプライマリからセカンダリ、オブジェクト ストレージへ、そしてセカンダリからオブジェクト ストレージへと流れます。
** *ファンアウト*: 情報はプライマリからセカンダリへ、そしてプライマリからオブジェクト ストレージへ流れます。
+
これらのアーキテクチャの詳細については、link:prev-ontap-protect-journey.html["保護の旅を計画する"] 。



. *ローカル スナップショット*: 既存のスナップショット ポリシーを選択するか、ポリシーを作成します。
+

TIP: スナップショットをアクティブ化する前にカスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

. ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。
+
** ポリシーの名前を入力します。
** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
+
*** オブジェクトへのバックアップ ポリシーの場合は、DataLock と Ransomware Resilience の設定を行います。  DataLockとランサムウェア耐性の詳細については、以下を参照してください。link:prev-ontap-policy-object-options.html["オブジェクトへのバックアップポリシー設定"] 。


** *作成*を選択します。


. *レプリケーション*: 次のオプションを設定します。
+
** *レプリケーション ターゲット*: 宛先システムと SVM を選択します。必要に応じて、複製先のアグリゲート (複数可) と、複製されたボリューム名に追加されるプレフィックスまたはサフィックスを選択します。
** *レプリケーション ポリシー*: 既存のレプリケーション ポリシーを選択するか、ポリシーを作成します。
+

TIP: レプリケーションをアクティブ化する前にカスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
*** ポリシーの名前を入力します。
*** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
*** *作成*を選択します。




. *オブジェクトにバックアップ*: *バックアップ*を選択した場合は、次のオプションを設定します。
+
** *プロバイダー*: *Amazon Web Services* を選択します。
** *プロバイダー設定*: プロバイダーの詳細と、バックアップを保存する AWS リージョンを入力します。
+
アクセス キーとシークレット キーは、 ONTAPクラスターに S3 バケットへのアクセス権を付与するために作成した IAM ユーザー用です。

** *バケット*: 既存の S3 バケットを選択するか、新しいバケットを作成します。参照 https://docs.netapp.com/us-en/storage-management-s3-storage/task-add-s3-bucket.html["S3バケットを追加する"^]。
** *暗号化キー*: 新しい S3 バケットを作成した場合は、プロバイダーから提供された暗号化キー情報を入力します。データの暗号化を管理するために、デフォルトの Amazon S3 暗号化キーを使用するか、AWS アカウントから独自のカスタマー管理キーを選択するかを選択します。


+

NOTE: 既存のバケットを選択した場合は、暗号化情報がすでに利用可能であるため、ここで入力する必要はありません。

+
** *ネットワーク*: IPspace を選択し、プライベート エンドポイントを使用するかどうかを選択します。プライベート エンドポイントはデフォルトで無効になっています。
+
... バックアップするボリュームが存在するONTAPクラスタ内の IPspace。この IPspace のクラスタ間 LIF には、アウトバウンド インターネット アクセスが必要です。
... 必要に応じて、以前に設定した AWS PrivateLink を使用するかどうかを選択します。 https://docs.aws.amazon.com/AmazonS3/latest/userguide/privatelink-interface-endpoints.html["Amazon S3 の AWS PrivateLink の使用に関する詳細をご覧ください"^] 。


** *バックアップ ポリシー*: 既存のバックアップ ポリシーを選択するか、ポリシーを作成します。
+

TIP: バックアップをアクティブ化する前にカスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
*** ポリシーの名前を入力します。
*** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
*** *作成*を選択します。


** *既存のスナップショット コピーをバックアップ コピーとしてオブジェクト ストレージにエクスポートします*: このシステムで選択したバックアップ スケジュール ラベル (たとえば、毎日、毎週など) に一致する、このシステムのボリュームのローカル スナップショット コピーがある場合は、この追加プロンプトが表示されます。このボックスをオンにすると、すべての履歴スナップショットがバックアップ ファイルとしてオブジェクト ストレージにコピーされ、ボリュームの保護が最も完全になります。


. *次へ*を選択します。




=== 選択内容を確認する

ここで選択内容を確認し、必要に応じて調整を行うことができます。

.手順
. 「レビュー」ページで選択内容を確認します。
. オプションで、*スナップショット ポリシー ラベルをレプリケーション ポリシー ラベルおよびバックアップ ポリシー ラベルと自動的に同期する* チェックボックスをオンにします。これにより、レプリケーションおよびバックアップ ポリシーのラベルと一致するラベルを持つスナップショットが作成されます。
. *バックアップの有効化*を選択します。


.結果
NetApp Backup and Recovery はボリュームの初期バックアップの作成を開始します。複製されたボリュームとバックアップ ファイルのベースライン転送には、プライマリ ストレージ システム データの完全なコピーが含まれます。後続の転送には、スナップショット コピーに含まれるプライマリ データの差分コピーが含まれます。

複製されたボリュームが宛先クラスターに作成され、プライマリ ストレージ ボリュームと同期されます。

入力した S3 アクセスキーとシークレットキーで示されるサービスアカウントに S3 バケットが作成され、そこにバックアップファイルが保存されます。ボリューム バックアップ ダッシュボードが表示され、バックアップの状態を監視できます。

バックアップと復元ジョブのステータスを監視することもできます。link:br-use-monitor-tasks.html["ジョブ監視ページ"^] 。



=== APIコマンドを表示する

バックアップとリカバリのアクティブ化ウィザードで使用される API コマンドを表示し、必要に応じてコピーすることもできます。将来のシステムでバックアップのアクティベーションを自動化するには、これを実行する必要がある場合があります。

.手順
. バックアップとリカバリのアクティブ化ウィザードから、*API リクエストの表示*を選択します。
. コマンドをクリップボードにコピーするには、[コピー] アイコンを選択します。

