---
sidebar: sidebar 
permalink: prev-ontap-restore.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, NetApp Backup and Recovery, Oracle database, Microsoft SQL Server database, SAP HANA database 
summary: NetApp Backup and Recovery を使用すると、バックアップ ファイルからONTAPボリューム全体を復元したり、少数のファイルのみを復元する必要がある場合は、フォルダーまたは個々のファイルを復元したりできます。 
---
= NetApp Backup and Recoveryを使用してバックアップファイルからONTAPデータを復元する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ONTAPボリューム データのバックアップは、バックアップを作成した場所（スナップショット コピー、複製されたボリューム、オブジェクト ストレージに保存されたバックアップ）から利用できます。これらのバックアップ場所のいずれからでも、特定の時点のデータを復元できます。  NetApp Backup and Recovery を使用すると、バックアップ ファイルからONTAPボリューム全体を復元したり、少数のファイルのみを復元する必要がある場合は、フォルダーまたは個々のファイルを復元したりできます。

[]
====
*注意* NetApp Backup and Recoveryのワークロードを切り替えるには、link:br-start-switch-ui.html["さまざまなNetApp Backup and Recoveryワークロードに切り替える"] 。

====
* *ボリューム* (新しいボリュームとして) を元のシステム、同じクラウド アカウントを使用している別のシステム、またはオンプレミスのONTAPシステムに復元できます。
* *フォルダー* を元のシステムのボリューム、同じクラウド アカウントを使用している別のシステムのボリューム、またはオンプレミスのONTAPシステム上のボリュームに復元できます。
* *ファイル* を元のシステムのボリューム、同じクラウド アカウントを使用している別のシステムのボリューム、またはオンプレミスのONTAPシステム上のボリュームに復元できます。


バックアップ ファイルから実稼働システムにデータを復元するには、有効なNetApp Backup and Recoveryライセンスが必要です。

要約すると、ボリューム データをONTAPシステムに復元するために使用できる有効なフローは次のとおりです。

* バックアップファイル -> 復元されたボリューム
* 複製されたボリューム -> 復元されたボリューム
* スナップショットコピー -> 復元されたボリューム



NOTE: 復元操作が完了しない場合は、ジョブ モニターに「失敗」と表示されるまで待ってから、復元操作を再試行してください。


NOTE: ONTAPデータのリストアに関する制限については、link:br-reference-limitations.html["ONTAPボリュームのバックアップとリストアの制限"] 。



== 復元ダッシュボード

復元ダッシュボードを使用して、ボリューム、フォルダー、およびファイルの復元操作を実行します。復元ダッシュボードにアクセスするには、コンソール メニューから [*バックアップと復元*] をクリックし、[*復元*] タブをクリックします。クリックすることもできますimage:icon-options-vertical.gif["詳細ボタン"]> サービス パネルのバックアップと復元サービスから *復元ダッシュボードを表示* します。


NOTE: NetApp Backup and Recovery は少なくとも 1 つのシステムに対してすでにアクティブ化されており、初期バックアップ ファイルが存在している必要があります。

復元ダッシュボードでは、バックアップ ファイルからデータを復元する方法として、「参照と復元」と「検索と復元」の 2 つの方法が提供されています。



== 参照と復元と検索と復元の比較

一般的に言えば、_参照と復元_ は、過去 1 週間または 1 か月間の特定のボリューム、フォルダー、またはファイルを復元する必要がある場合に適しています。この場合、ファイルの名前と場所、およびファイルが最後に正常な状態であった日付が分かっています。通常、ボリューム、フォルダー、またはファイルを復元する必要があるが、正確な名前や、それらが存在するボリューム、またはそれらが最後に正常な状態であった日付を覚えていない場合は、_検索と復元_ の方が適しています。

この表は、2 つの方法の機能の比較を示しています。

[cols="50,50"]
|===
| 閲覧と復元 | 検索と復元 


| フォルダー形式の構造を参照して、単一のバックアップ ファイル内のボリューム、フォルダー、またはファイルを見つけます。 | 部分的または完全なボリューム名、部分的または完全なフォルダー/ファイル名、サイズの範囲、追加の検索フィルターを使用して、*すべてのバックアップ ファイル* 間でボリューム、フォルダー、またはファイルを検索します。 


| ファイルが削除または名前変更され、ユーザーが元のファイル名を知らない場合、ファイルの回復は処理されません。 | 新しく作成/削除/名前変更されたディレクトリと新しく作成/削除/名前変更されたファイルを処理します 


| 追加のクラウドプロバイダーリソースは不要 | クラウドから復元する場合は、アカウントごとに追加のバケットとパブリック クラウド プロバイダーのリソースが必要になります。 


| 追加のクラウドプロバイダー費用は不要 | クラウドから復元する場合、バックアップとボリュームをスキャンして検索結果を取得する際に追加のコストが必要になります。 


| クイック復元がサポートされています。 | クイック復元はサポートされていません。 
|===
この表には、バックアップ ファイルが存在する場所に基づいて、有効な復元操作の一覧が示されています。

[cols="14h,14,14,14,14,14,14"]
|===
| バックアップ タイプ 3+| 閲覧と復元 3+| 検索と復元 


|  | *ボリュームを復元* | *ファイルを復元* | *フォルダを復元* | *ボリュームを復元* | *ファイルを復元* | *フォルダを復元* 


| Snapshotコピー | はい | いいえ | いいえ | はい | はい | はい 


| 複製ボリューム | はい | いいえ | いいえ | はい | はい | はい 


| バックアップファイル | はい | はい | はい | はい | はい | はい 
|===
いずれかの復元方法を使用する前に、固有のリソース要件に合わせて環境が構成されていることを確認してください。これらの要件については、以下のセクションで説明します。

使用する復元操作の種類に応じた要件と復元手順を参照してください。

* <<参照と復元を使用してボリュームを復元する,参照と復元を使用してボリュームを復元する>>
* <<参照と復元を使用してフォルダとファイルを復元する,参照と復元を使用してフォルダとファイルを復元する>>
* <<restore-ontap-data-using-search-restore,検索と復元を使用してボリューム、フォルダ、ファイルを復元する>>




== 参照と復元を使用してONTAPデータを復元する

ボリューム、フォルダ、またはファイルの復元を開始する前に、復元元のボリュームの名前、ボリュームが存在するシステムと SVM の名前、および復元元のバックアップ ファイルのおおよその日付を知っておく必要があります。  ONTAPデータは、Snapshot コピー、複製されたボリューム、またはオブジェクト ストレージに保存されているバックアップから復元できます。

*注:* 復元するデータを含むバックアップ ファイルがアーカイブ クラウド ストレージ ( ONTAP 9.10.1 以降) に存在する場合、復元操作には時間がかかり、コストも発生します。さらに、宛先クラスタでは、ボリュームの復元の場合はONTAP 9.10.1 以上、ファイルの復元の場合は 9.11.1、Google Archive およびStorageGRIDの場合は 9.12.1、フォルダの復元の場合は 9.13.1 も実行されている必要があります。

ifdef::aws[]

link:prev-reference-aws-archive-storage-tiers.html["AWSアーカイブストレージからの復元の詳細"]。

endif::aws[]

ifdef::azure[]

link:prev-reference-azure-archive-storage-tiers.html["Azure アーカイブ ストレージからの復元の詳細"]。

endif::azure[]

ifdef::gcp[]

link:prev-reference-gcp-archive-storage-tiers.html["Google アーカイブ ストレージからの復元の詳細"]。

endif::gcp[]


NOTE: Azure アーカイブ ストレージからStorageGRIDシステムにデータを復元する場合、高優先度はサポートされません。



=== サポートされているシステムとオブジェクト ストレージ プロバイダーを参照および復元する

セカンダリ システム (複製されたボリューム) またはオブジェクト ストレージ (バックアップ ファイル) にあるバックアップ ファイルから、次のシステムにONTAPデータを復元できます。スナップショット コピーはソース システム上に存在し、同じシステムにのみ復元できます。

*注:* ボリュームはどのタイプのバックアップ ファイルからでも復元できますが、現時点では、フォルダーまたは個々のファイルはオブジェクト ストレージ内のバックアップ ファイルからのみ復元できます。

[cols="25,25,25,25"]
|===
| *オブジェクトストアから（バックアップ）* | *プライマリから（スナップショット）* | *セカンダリシステムから（レプリケーション）* | 宛先システム ifdef::aws[] 


| Amazon S3 | AWS オンプレミスONTAPシステムのCloud Volumes ONTAP | AWS オンプレミスONTAPシステムのCloud Volumes ONTAP endif::aws[] ifdef::azure[] | Azure ブロブ 


| Azure のCloud Volumes ONTAPオンプレミスONTAPシステム | Azure のCloud Volumes ONTAPオンプレミスONTAPシステム endif::azure[] ifdef::gcp[] | Google Cloud Storage | Google オンプレミスONTAPシステムのCloud Volumes ONTAP 


| Google オンプレミスONTAPシステムのCloud Volumes ONTAP endif::gcp[] | NetAppStorageGRID | オンプレミスのONTAPシステム | オンプレミスのONTAPシステムCloud Volumes ONTAP 


| オンプレミスのONTAPシステムへ | ONTAP S3 | オンプレミスのONTAPシステム | オンプレミスのONTAPシステムCloud Volumes ONTAP 
|===
ifdef::aws[]

endif::aws[]

ifdef::azure[]

endif::azure[]

ifdef::gcp[]

endif::gcp[]

参照と復元の場合、コンソール エージェントは次の場所にインストールできます。

ifdef::aws[]

* Amazon S3の場合、コンソールエージェントはAWSまたはオンプレミスに導入できます。


endif::aws[]

ifdef::azure[]

* Azure Blobの場合、コンソールエージェントはAzureまたはオンプレミスに展開できます。


endif::azure[]

ifdef::gcp[]

* Google Cloud Storage の場合、コンソール エージェントを Google Cloud Platform VPC にデプロイする必要があります。


endif::gcp[]

* StorageGRIDの場合、コンソールエージェントは、インターネットアクセスの有無にかかわらず、お客様の敷地内に導入する必要があります。
* ONTAP S3の場合、コンソールエージェントは、オンプレミス（インターネットアクセスの有無にかかわらず）またはクラウドプロバイダー環境に導入できます。


「オンプレミスのONTAPシステム」への参照には、 FAS、 AFF、およびONTAP Selectシステムが含まれることに注意してください。


NOTE: システムのONTAPバージョンが 9.13.1 未満の場合、バックアップ ファイルが DataLock & Ransomware で構成されていると、フォルダーまたはファイルを復元できません。この場合、バックアップ ファイルからボリューム全体を復元し、必要なファイルにアクセスできます。



=== 参照と復元を使用してボリュームを復元する

バックアップ ファイルからボリュームを復元すると、 NetApp Backup and Recovery はバックアップのデータを使用して新しいボリュームを作成します。オブジェクト ストレージからのバックアップを使用すると、データを元のシステムのボリューム、ソース システムと同じクラウド アカウントにある別のシステム、またはオンプレミスのONTAPシステムに復元できます。

ONTAP 9.13.0 以降を使用しているCloud Volumes ONTAPシステム、またはONTAP 9.14.1 を実行しているオンプレミスのONTAPシステムにクラウド バックアップを復元する場合は、_クイック リストア_ 操作を実行するオプションがあります。クイック リストアは、ボリュームへのアクセスをできるだけ早く提供する必要がある災害復旧の状況に最適です。クイック リストアでは、バックアップ ファイル全体を復元するのではなく、バックアップ ファイルからボリュームにメタデータを復元します。クイック リストアは、パフォーマンスや待ち時間が重要となるアプリケーションには推奨されません。また、アーカイブ ストレージ内のバックアップではサポートされません。


NOTE: クイック リストアは、クラウド バックアップが作成されたソース システムでONTAP 9.12.1 以降が実行されている場合にのみ、 FlexGroupボリュームに対してサポートされます。また、ソース システムでONTAP 9.11.0 以降が実行されている場合にのみ、 SnapLockボリュームでサポートされます。

複製されたボリュームから復元する場合、ボリュームを元のシステム、 Cloud Volumes ONTAPまたはオンプレミスのONTAPシステムに復元できます。

image:diagram_browse_restore_volume.png["参照と復元を使用してボリューム復元操作を実行するフローを示す図。"]

ご覧のとおり、ボリュームの復元を実行するには、ソース システム名、ストレージ VM、ボリューム名、およびバックアップ ファイルの日付を知る必要があります。

.手順
. コンソール メニューから、*保護 > バックアップとリカバリ* を選択します。
. *復元*タブを選択すると、復元ダッシュボードが表示されます。
. [参照と復元] セクションから、[ボリュームの復元] を選択します。
. [_ソースの選択_] ページで、復元するボリュームのバックアップ ファイルに移動します。復元する日付/タイムスタンプを持つ *システム*、*ボリューム*、および *バックアップ* ファイルを選択します。
+
*場所* 列には、バックアップ ファイル (スナップショット) が *ローカル* (ソース システム上のスナップショット コピー)、*セカンダリ* (セカンダリONTAPシステム上の複製されたボリューム)、または *オブジェクト ストレージ* (オブジェクト ストレージ内のバックアップ ファイル) のいずれであるかが表示されます。復元するファイルを選択します。

. *次へ*を選択します。
+
オブジェクト ストレージ内のバックアップ ファイルを選択し、そのバックアップに対してランサムウェア耐性がアクティブになっている場合 (バックアップ ポリシーで DataLock とランサムウェア耐性を有効にした場合)、データを復元する前に、バックアップ ファイルに対して追加のランサムウェア スキャンを実行するように求められます。バックアップ ファイルをランサムウェアのスキャン対象とすることをお勧めします。  (バックアップ ファイルの内容にアクセスするには、クラウド プロバイダーから追加の送信コストが発生します。)

. [_宛先の選択_] ページで、ボリュームを復元する *システム* を選択します。
. オブジェクト ストレージからバックアップ ファイルを復元するときに、オンプレミスのONTAPシステムを選択し、オブジェクト ストレージへのクラスタ接続をまだ構成していない場合は、追加情報の入力を求められます。
+
ifdef::aws[]

+
** Amazon S3 から復元する場合は、宛先ボリュームが存在するONTAPクラスター内の IPspace を選択し、作成したユーザーのアクセス キーとシークレット キーを入力してONTAPクラスターに S3 バケットへのアクセス権を付与し、オプションで安全なデータ転送のためにプライベート VPC エンドポイントを選択します。




endif::aws[]

ifdef::azure[]

* Azure Blob から復元する場合は、宛先ボリュームが存在するONTAPクラスター内の IPspace を選択し、オブジェクト ストレージにアクセスするための Azure サブスクリプションを選択し、オプションで VNet とサブネットを選択して、安全なデータ転送のためのプライベート エンドポイントを選択します。


endif::azure[]

ifdef::gcp[]

* Google Cloud Storage から復元する場合は、Google Cloud プロジェクトとアクセス キーおよびシークレット キーを選択して、オブジェクト ストレージ、バックアップが保存されるリージョン、および宛先ボリュームが存在するONTAPクラスター内の IPspace にアクセスします。


endif::gcp[]

* StorageGRIDから復元する場合は、 StorageGRIDサーバーの FQDN と、 ONTAP がStorageGRIDとの HTTPS 通信に使用するポートを入力し、オブジェクト ストレージにアクセスするために必要なアクセス キーとシークレット キー、および宛先ボリュームが存在するONTAPクラスタ内の IPspace を選択します。
* ONTAP S3 からリストアする場合は、 ONTAP S3 サーバーの FQDN と、 ONTAP がONTAP S3 との HTTPS 通信に使用するポートを入力し、オブジェクト ストレージにアクセスするために必要なアクセス キーとシークレット キー、および宛先ボリュームが存在するONTAPクラスター内の IPspace を選択します。
+
.. 復元されたボリュームに使用する名前を入力し、ボリュームが保存されるストレージ VM とアグリゲートを選択します。 FlexGroupボリュームを復元する場合は、複数のアグリゲートを選択する必要があります。デフォルトでは、ボリューム名として *<source_volume_name>_restore* が使用されます。
+
オブジェクト ストレージからONTAP 9.13.0 以上を使用するCloud Volumes ONTAPシステム、またはONTAP 9.14.1 を実行するオンプレミスのONTAPシステムにバックアップを復元する場合は、クイック復元操作を実行するオプションがあります。

+
また、アーカイブ ストレージ層 ( ONTAP 9.10.1 以降で利用可能) にあるバックアップ ファイルからボリュームを復元する場合は、復元優先度を選択できます。

+
ifdef::aws[]





link:prev-reference-aws-archive-storage-tiers.html["AWSアーカイブストレージからの復元の詳細"]。

endif::aws[]

ifdef::azure[]

link:prev-reference-azure-archive-storage-tiers.html["Azure アーカイブ ストレージからの復元の詳細"]。

endif::azure[]

ifdef::gcp[]

link:prev-reference-gcp-archive-storage-tiers.html["Google アーカイブ ストレージからの復元の詳細"]。Google アーカイブ ストレージ層のバックアップ ファイルはほぼ即座に復元されるため、復元の優先順位は必要ありません。

endif::gcp[]

. [次へ] を選択して、通常の復元プロセスを実行するか、クイック復元プロセスを実行するかを選択します。
+
** *通常の復元*: 高いパフォーマンスが必要なボリュームでは通常の復元を使用します。復元プロセスが完了するまでボリュームは使用できません。
** *クイック復元*: 復元されたボリュームとデータはすぐに利用できるようになります。クイック リストア プロセス中はデータへのアクセスが通常よりも遅くなる可能性があるため、高パフォーマンスが必要なボリュームではこれを使用しないでください。


. *復元*を選択すると、復元ダッシュボードに戻り、復元操作の進行状況を確認できます。


.結果
NetApp Backup and Recovery は、選択したバックアップに基づいて新しいボリュームを作成します。

アーカイブ ストレージにあるバックアップ ファイルからボリュームを復元する場合、アーカイブ層と復元の優先度に応じて数分から数時間かかる場合があることに注意してください。復元の進行状況を確認するには、[*ジョブ監視*] タブを選択します。



=== 参照と復元を使用してフォルダとファイルを復元する

ONTAPボリューム バックアップから少数のファイルのみを復元する必要がある場合は、ボリューム全体を復元するのではなく、フォルダーまたは個々のファイルを復元することを選択できます。フォルダーとファイルを元のシステムの既存のボリュームに復元することも、同じクラウド アカウントを使用している別のシステムに復元することもできます。オンプレミスのONTAPシステム上のボリュームにフォルダーとファイルを復元することもできます。


NOTE: 現時点では、オブジェクト ストレージ内のバックアップ ファイルからのみフォルダーまたは個々のファイルを復元できます。現在、ローカル スナップショット コピーまたはセカンダリ システム (複製されたボリューム) にあるバックアップ ファイルからのファイルとフォルダーの復元はサポートされていません。

複数のファイルを選択した場合、すべてのファイルは選択した同じ宛先ボリュームに復元されます。したがって、ファイルを別のボリュームに復元する場合は、復元プロセスを複数回実行する必要があります。

ONTAP 9.13.0 以降を使用している場合は、フォルダーとその中のすべてのファイルおよびサブフォルダーを復元できます。  9.13.0 より前のバージョンのONTAPを使用する場合、そのフォルダのファイルのみが復元され、サブフォルダまたはサブフォルダ内のファイルは復元されません。

[NOTE]
====
* バックアップ ファイルに DataLock および Ransomware 保護が設定されている場合、 ONTAPバージョンが 9.13.1 以上の場合にのみフォルダー レベルの復元がサポートされます。以前のバージョンのONTAPを使用している場合は、バックアップ ファイルからボリューム全体を復元し、必要なフォルダーとファイルにアクセスできます。
* バックアップ ファイルがアーカイブ ストレージに存在する場合、 ONTAPバージョンが 9.13.1 以上の場合にのみ、フォルダー レベルの復元がサポートされます。以前のバージョンのONTAPを使用している場合は、アーカイブされていない新しいバックアップ ファイルからフォルダを復元するか、アーカイブされたバックアップからボリューム全体を復元して、必要なフォルダとファイルにアクセスすることができます。
* ONTAP 9.15.1 では、「参照と復元」オプションを使用してFlexGroupフォルダを復元できます。この機能はテクノロジープレビュー モードです。
+
特別なフラグを使用してテストすることができます。 https://community.netapp.com/t5/Tech-ONTAP-Blogs/BlueXP-Backup-and-Recovery-July-2024-Release/ba-p/453993#toc-hId-1830672444["NetApp Backup and Recovery2024 年 7 月リリース ブログ"^] 。



====


==== 前提条件

* _ファイル_復元操作を実行するには、 ONTAPバージョンが 9.6 以上である必要があります。
* フォルダの復元操作を実行するには、 ONTAPバージョンが 9.11.1 以上である必要があります。データがアーカイブ ストレージにある場合、またはバックアップ ファイルで DataLock およびランサムウェア保護が使用されている場合は、 ONTAPバージョン 9.13.1 が必要です。
* 参照と復元オプションを使用してFlexGroupディレクトリを復元するには、 ONTAPバージョンが 9.15.1 p2 以上である必要があります。




==== フォルダとファイルの復元プロセス

プロセスは次のようになります。

. ボリューム バックアップからフォルダーまたは 1 つ以上のファイルを復元する場合は、[復元] タブをクリックし、[参照と復元] の下にある [ファイルまたはフォルダーの復元] をクリックします。
. フォルダーまたはファイルが存在するソース システム、ボリューム、およびバックアップ ファイルを選択します。
. NetApp Backup and Recovery、選択したバックアップ ファイル内に存在するフォルダとファイルが表示されます。
. そのバックアップから復元するフォルダーまたはファイルを選択します。
. フォルダまたはファイルを復元する宛先場所 (システム、ボリューム、フォルダ) を選択し、[復元] をクリックします。
. ファイルが復元されました。


image:diagram_browse_restore_file.png["参照と復元を使用してファイルの復元操作を実行するフローを示した図。"]

ご覧のとおり、フォルダーまたはファイルの復元を実行するには、システム名、ボリューム名、バックアップ ファイルの日付、およびフォルダー/ファイル名を知っておく必要があります。



==== フォルダとファイルを復元する

ONTAPボリューム バックアップからボリュームにフォルダーまたはファイルを復元するには、次の手順に従います。フォルダーまたはファイルを復元するために使用するボリュームの名前とバックアップ ファイルの日付を知っておく必要があります。この機能はライブ ブラウジングを使用するため、各バックアップ ファイル内のディレクトリとファイルのリストを表示できます。

.手順
. コンソール メニューから、*保護 > バックアップとリカバリ* を選択します。
. *復元*タブを選択すると、復元ダッシュボードが表示されます。
. [参照と復元] セクションで、[ファイルまたはフォルダーの復元] を選択します。
. [_ソースの選択_] ページで、復元するフォルダーまたはファイルが含まれているボリュームのバックアップ ファイルに移動します。ファイルを復元する日付/タイムスタンプを持つ *システム*、*ボリューム*、および *バックアップ* を選択します。
. [次へ] を選択すると、ボリューム バックアップのフォルダーとファイルのリストが表示されます。
+
アーカイブ ストレージ層にあるバックアップ ファイルからフォルダーまたはファイルを復元する場合は、復元の優先順位を選択できます。

+
link:prev-reference-aws-archive-storage-tiers.html["AWSアーカイブストレージからの復元の詳細"]。link:prev-reference-azure-archive-storage-tiers.html["Azure アーカイブ ストレージからの復元の詳細"]。link:prev-reference-gcp-archive-storage-tiers.html["Google アーカイブ ストレージからの復元の詳細"]。Google アーカイブ ストレージ層のバックアップ ファイルはほぼ即座に復元されるため、復元の優先順位は必要ありません。

+
また、バックアップ ファイルに対して Ransomware Resilience がアクティブになっている場合 (バックアップ ポリシーで DataLock と Ransomware Resilience を有効にした場合)、データを復元する前に、バックアップ ファイルに対して追加のランサムウェア スキャンを実行するように求められます。バックアップ ファイルをランサムウェアのスキャン対象とすることをお勧めします。  (バックアップ ファイルの内容にアクセスするには、クラウド プロバイダーから追加の送信コストが発生します。)

. [_アイテムの選択_] ページで、復元するフォルダーまたはファイルを選択し、[続行] を選択します。アイテムを見つける際に役立つ情報:
+
** フォルダーまたはファイル名が表示されている場合はそれを選択できます。
** 検索アイコンを選択し、フォルダーまたはファイルの名前を入力すると、アイテムに直接移動できます。
** 行の末尾にある下矢印を使用してフォルダー内の下のレベルに移動し、特定のファイルを見つけることができます。
+
ファイルを選択すると、ページの左側に追加されるので、すでに選択したファイルを確認できます。必要に応じて、ファイル名の横にある *x* を選択して、このリストからファイルを削除できます。



. [_宛先の選択_] ページで、アイテムを復元する *システム* を選択します。
+
オンプレミス クラスターを選択し、オブジェクト ストレージへのクラスター接続をまだ構成していない場合は、追加情報の入力を求められます。

+
ifdef::aws[]

+
** Amazon S3 から復元する場合は、宛先ボリュームが存在するONTAPクラスターの IPspace と、オブジェクト ストレージにアクセスするために必要な AWS アクセス キーとシークレット キーを入力します。クラスターへの接続にプライベート リンク構成を選択することもできます。




endif::aws[]

ifdef::azure[]

* Azure Blob から復元する場合は、宛先ボリュームが存在するONTAPクラスター内の IPspace を入力します。クラスターへの接続にプライベート エンドポイント構成を選択することもできます。


endif::azure[]

ifdef::gcp[]

* Google Cloud Storage から復元する場合は、宛先ボリュームが存在するONTAPクラスター内の IPspace と、オブジェクト ストレージにアクセスするために必要なアクセス キーとシークレット キーを入力します。


endif::gcp[]

* StorageGRIDから復元する場合は、 StorageGRIDサーバーの FQDN と、 ONTAP がStorageGRIDとの HTTPS 通信に使用するポートを入力し、オブジェクト ストレージにアクセスするために必要なアクセス キーとシークレット キー、および宛先ボリュームが存在するONTAPクラスタ内の IPspace を入力します。
+
.. 次に、フォルダーまたはファイルを復元する *ボリューム* と *フォルダー* を選択します。
+
フォルダーやファイルを復元する際の場所についてはいくつかのオプションがあります。



* 上記のように*ターゲットフォルダーの選択*を選択した場合:
+
** 任意のフォルダを選択できます。
** フォルダーの上にマウスを移動し、行の末尾をクリックしてサブフォルダーにドリルダウンし、フォルダーを選択できます。


* ソース フォルダ/ファイルが配置されていたのと同じ宛先システムとボリュームを選択した場合は、[*ソース フォルダ パスを維持*] を選択して、フォルダまたはファイルをソース構造に存在していたのと同じフォルダに復元できます。同じフォルダーとサブフォルダーがすべてすでに存在している必要があります。フォルダーは作成されません。ファイルを元の場所に復元する場合、ソース ファイルを上書きするか、新しいファイルを作成するかを選択できます。
+
.. *復元*を選択すると、復元ダッシュボードに戻り、復元操作の進行状況を確認できます。また、*ジョブ監視*タブをクリックして、復元の進行状況を確認することもできます。






== 検索と復元を使用してONTAPデータを復元する

検索と復元を使用して、 ONTAPバックアップ ファイルからボリューム、フォルダー、またはファイルを復元できます。検索と復元を使用すると、すべてのバックアップから特定のボリューム、フォルダー、またはファイルを検索し、復元を実行できます。正確なシステム名、ボリューム名、またはファイル名を知る必要はありません。検索ではすべてのボリューム バックアップ ファイルを検索します。

検索操作では、 ONTAPボリュームに存在するすべてのローカル スナップショット コピー、セカンダリ ストレージ システム上のすべての複製ボリューム、およびオブジェクト ストレージに存在するすべてのバックアップ ファイルを検索します。ローカルのスナップショット コピーまたは複製されたボリュームからデータを復元する方が、オブジェクト ストレージ内のバックアップ ファイルから復元するよりも高速でコストも抑えられるため、これらの他の場所からデータを復元することもできます。

バックアップ ファイルから完全なボリュームを復元すると、 NetApp Backup and Recovery はバックアップのデータを使用して新しいボリュームを作成します。データは、元のシステムのボリュームとして、ソース システムと同じクラウド アカウントにある別のシステム、またはオンプレミスのONTAPシステムに復元できます。

フォルダーまたはファイルを、元のボリュームの場所、同じシステム内の別のボリューム、同じクラウド アカウントを使用している別のシステム、またはオンプレミスのONTAPシステム上のボリュームに復元できます。

ONTAP 9.13.0 以降を使用している場合は、フォルダーとその中のすべてのファイルおよびサブフォルダーを復元できます。  9.13.0 より前のバージョンのONTAPを使用する場合、そのフォルダのファイルのみが復元され、サブフォルダまたはサブフォルダ内のファイルは復元されません。

復元するボリュームのバックアップ ファイルがアーカイブ ストレージ ( ONTAP 9.10.1 以降で使用可能) に存在する場合、復元操作には時間がかかり、追加のコストが発生します。なお、宛先クラスタでは、ボリュームの復元の場合はONTAP 9.10.1 以上、ファイルの復元の場合は 9.11.1、Google Archive およびStorageGRIDの場合は 9.12.1、フォルダの復元の場合は 9.13.1 を実行している必要があります。

ifdef::aws[]

link:prev-reference-aws-archive-storage-tiers.html["AWSアーカイブストレージからの復元の詳細"]。

endif::aws[]

ifdef::azure[]

link:prev-reference-azure-archive-storage-tiers.html["Azure アーカイブ ストレージからの復元の詳細"]。

endif::azure[]

ifdef::gcp[]

link:prev-reference-gcp-archive-storage-tiers.html["Google アーカイブ ストレージからの復元の詳細"]。

endif::gcp[]

[NOTE]
====
* オブジェクト ストレージ内のバックアップ ファイルに DataLock および Ransomware 保護が設定されている場合、 ONTAPバージョンが 9.13.1 以上の場合にのみフォルダー レベルの復元がサポートされます。以前のバージョンのONTAPを使用している場合は、バックアップ ファイルからボリューム全体を復元し、必要なフォルダーとファイルにアクセスできます。
* オブジェクト ストレージ内のバックアップ ファイルがアーカイブ ストレージに存在する場合、 ONTAPバージョンが 9.13.1 以上の場合にのみ、フォルダー レベルの復元がサポートされます。以前のバージョンのONTAPを使用している場合は、アーカイブされていない新しいバックアップ ファイルからフォルダを復元するか、アーカイブされたバックアップからボリューム全体を復元して、必要なフォルダとファイルにアクセスすることができます。
* Azure アーカイブ ストレージからStorageGRIDシステムにデータを復元する場合、「高」復元優先度はサポートされません。
* 現在、 ONTAP S3 オブジェクト ストレージ内のボリュームからのフォルダーの復元はサポートされていません。


====
開始する前に、復元するボリュームまたはファイルの名前または場所をある程度把握しておく必要があります。



=== 検索と復元がサポートされているシステムとオブジェクト ストレージ プロバイダー

セカンダリ システム (複製されたボリューム) またはオブジェクト ストレージ (バックアップ ファイル) にあるバックアップ ファイルから、次のシステムにONTAPデータを復元できます。スナップショット コピーはソース システム上に存在し、同じシステムにのみ復元できます。

*注意:* ボリュームとファイルはどのタイプのバックアップ ファイルからでも復元できますが、現時点では、フォルダーを復元できるのはオブジェクト ストレージ内のバックアップ ファイルからのみです。

[cols="33,33,33"]
|===
2+| バックアップファイルの場所 | 宛先システム 


| *オブジェクトストア（バックアップ）* | *セカンダリシステム（レプリケーション）* | ifdef::aws[] 


| Amazon S3 | AWS オンプレミスONTAPシステムのCloud Volumes ONTAP | AWS オンプレミスONTAPシステムのCloud Volumes ONTAP endif::aws[] ifdef::azure[] 


| Azure ブロブ | Azure のCloud Volumes ONTAPオンプレミスONTAPシステム | Azure のCloud Volumes ONTAPオンプレミスONTAPシステム endif::azure[] ifdef::gcp[] 


| Google Cloud Storage | Google オンプレミスONTAPシステムのCloud Volumes ONTAP | Google オンプレミスONTAPシステムのCloud Volumes ONTAP endif::gcp[] 


| NetAppStorageGRID | オンプレミスのONTAPシステムCloud Volumes ONTAP | オンプレミスのONTAPシステム 


| ONTAP S3 | オンプレミスのONTAPシステムCloud Volumes ONTAP | オンプレミスのONTAPシステム 
|===
検索と復元の場合、コンソール エージェントは次の場所にインストールできます。

ifdef::aws[]

* Amazon S3の場合、コンソールエージェントはAWSまたはオンプレミスに導入できます。


endif::aws[]

ifdef::azure[]

* Azure Blobの場合、コンソールエージェントはAzureまたはオンプレミスに展開できます。


endif::azure[]

ifdef::gcp[]

* Google Cloud Storage の場合、コンソール エージェントを Google Cloud Platform VPC にデプロイする必要があります。


endif::gcp[]

* StorageGRIDの場合、コンソールエージェントは、インターネットアクセスの有無にかかわらず、お客様の敷地内に導入する必要があります。
* ONTAP S3の場合、コンソールエージェントは、オンプレミス（インターネットアクセスの有無にかかわらず）またはクラウドプロバイダー環境に導入できます。


「オンプレミスのONTAPシステム」への参照には、 FAS、 AFF、およびONTAP Selectシステムが含まれることに注意してください。



=== 前提条件

* クラスタの要件：
+
** ONTAPバージョンは 9.8 以上である必要があります。
** ボリュームが存在するストレージ VM (SVM) には、データ LIF が設定されている必要があります。
** ボリューム上で NFS を有効にする必要があります (NFS ボリュームと SMB/CIFS ボリュームの両方がサポートされています)。
** SnapDiff RPC サーバを SVM 上でアクティブ化する必要があります。システムでインデックス作成を有効にすると、コンソールはこれを自動的に実行します。  (SnapDiff は、スナップショット コピー間のファイルとディレクトリの違いを迅速に識別するテクノロジです。)




ifdef::aws[]

* AWS 要件:
+
** コンソールに権限を付与するユーザー ロールに、特定の Amazon Athena、AWS Glue、および AWS S3 権限を追加する必要があります。link:prev-ontap-backup-onprem-aws.html["すべての権限が正しく設定されていることを確認してください"]。
+
以前に設定したコンソール エージェントでNetApp Backup and Recoveryをすでに使用していた場合は、コンソール ユーザー ロールに Athena および Glue 権限を追加する必要があることに注意してください。これらは検索と復元に必要です。





endif::aws[]

ifdef::azure[]

* Azure の要件:
+
** Azure Synapse Analytics リソース プロバイダー (「Microsoft.Synapse」と呼ばれます) をサブスクリプションに登録する必要があります。 https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types#register-resource-provider["このリソースプロバイダーをサブスクリプションに登録する方法をご覧ください"^] 。リソース プロバイダーを登録するには、サブスクリプションの *所有者* または *投稿者* である必要があります。
** コンソールに権限を付与するユーザー ロールに、特定の Azure Synapse ワークスペースおよび Data Lake Storage アカウントの権限を追加する必要があります。link:prev-ontap-backup-onprem-azure.html["すべての権限が正しく設定されていることを確認してください"]。
+
以前に構成したコンソール エージェントでNetApp Backup and Recovery を既に使用していた場合は、Azure Synapse ワークスペースと Data Lake ストレージ アカウントのアクセス許可をコンソール ユーザー ロールに追加する必要があることに注意してください。これらは検索と復元に必要です。

** コンソール エージェントは、インターネットへの HTTP 通信用にプロキシ サーバーなしで構成する必要があります。コンソール エージェントに HTTP プロキシ サーバーを構成している場合は、検索と復元機能は使用できません。




endif::azure[]

ifdef::gcp[]

* Google Cloud の要件:
+
** NetApp Consoleに権限を付与するユーザー ロールに、特定の Google BigQuery 権限を追加する必要があります。link:prev-ontap-backup-onprem-gcp.html["すべての権限が正しく設定されていることを確認してください"]。
+
以前に構成したコンソール エージェントでNetApp Backup and Recovery をすでに使用していた場合は、コンソール ユーザー ロールに BigQuery 権限を追加する必要があります。これらは検索と復元に必要です。





endif::gcp[]

* StorageGRIDおよびONTAP S3 の要件:
+
構成に応じて、検索と復元を実装する方法は 2 つあります。

+
** アカウントにクラウド プロバイダーの資格情報がない場合、インデックス カタログ情報はコンソール エージェントに保存されます。
+
インデックス カタログ v2 の詳細については、インデックス カタログを有効にする方法に関する以下のセクションを参照してください。

** プライベート (ダーク) サイトでコンソール エージェントを使用している場合、インデックス カタログ情報はコンソール エージェントに保存されます (コンソール エージェント バージョン 3.9.25 以上が必要です)。
** もしあなたが https://docs.netapp.com/us-en/console-setup-admin/concept-accounts-aws.html["AWS認証情報"^]または https://docs.netapp.com/us-en/console-setup-admin/concept-accounts-azure.html["Azure 資格情報"^]アカウントにインデックスカタログがある場合は、クラウドに展開されたコンソールエージェントと同様に、インデックスカタログはクラウドプロバイダーに保存されます。  (両方の認証情報がある場合、デフォルトで AWS が選択されます。)
+
オンプレミスのコンソール エージェントを使用している場合でも、コンソール エージェントの権限とクラウド プロバイダー リソースの両方について、クラウド プロバイダーの要件を満たす必要があります。この実装を使用する場合は、上記の AWS および Azure の要件を参照してください。







=== 検索と復元のプロセス

プロセスは次のようになります。

. 検索と復元を使用する前に、ボリューム データを復元する各ソース システムで「インデックス作成」を有効にする必要があります。これにより、インデックス カタログは各ボリュームのバックアップ ファイルを追跡できるようになります。
. ボリューム バックアップからボリュームまたはファイルを復元する場合は、[_検索と復元_] で [*検索と復元*] を選択します。
. ボリューム名の一部または全部、ファイル名の一部または全部、バックアップ場所、サイズの範囲、作成日の範囲、その他の検索フィルターでボリューム、フォルダー、またはファイルの検索条件を入力し、[検索] を選択します。
+
「検索結果」ページには、検索条件に一致するファイルまたはボリュームがあるすべての場所が表示されます。

. ボリュームまたはファイルの復元に使用する場所の「すべてのバックアップを表示」を選択し、使用する実際のバックアップ ファイルで「復元」を選択します。
. ボリューム、フォルダー、またはファイルを復元する場所を選択し、「復元」を選択します。
. ボリューム、フォルダー、またはファイルが復元されます。


image:diagram_search_restore_vol_file.png["検索と復元を使用してボリューム、フォルダー、またはファイルの復元操作を実行するフローを示す図。"]

ご覧のとおり、実際には名前の一部を知るだけで、 NetApp Backup and Recovery は検索に一致するすべてのバックアップ ファイルを検索します。



=== 各システムでインデックスカタログを有効にする

検索と復元を使用する前に、ボリュームまたはファイルを復元する予定の各ソース システムで「インデックス作成」を有効にする必要があります。これにより、インデックス カタログはすべてのボリュームとすべてのバックアップ ファイルを追跡できるようになり、検索が非常に迅速かつ効率的になります。

インデックス カタログは、システム内のすべてのボリュームとバックアップ ファイルに関するメタデータを保存するデータベースです。これは、復元するデータが含まれているバックアップ ファイルをすばやく見つけるために、検索と復元機能によって使用されます。

.インデックスカタログv2の機能
2025 年 2 月にリリースされ、2025 年 6 月に更新された Indexed Catalog v2 には、より効率的で使いやすい機能が含まれています。このバージョンではパフォーマンスが大幅に向上しており、すべての新規顧客に対してデフォルトで有効になっています。

v2 に関する次の考慮事項を確認してください。

* Indexed Catalog v2 はプレビュー モードで利用できます。
* 既存のお客様で Catalog v2 を使用する場合は、環境のインデックスを完全に再作成する必要があります。
* カタログ v2 は、スナップショット ラベルを持つスナップショットのみをインデックス化します。
* NetApp Backup and Recovery は、 「時間別」のSnapMirrorラベルを使用してスナップショットをインデックス化しません。  「時間別」 SnapMirrorラベルを使用してスナップショットをインデックスする場合は、v2 がプレビュー モードのときに手動で有効にする必要があります。
* NetApp Backup and Recovery は、カタログ v2 のみを使用して、NetApp Backup and Recoveryによって保護されているシステムに関連付けられたボリュームとスナップショットをインデックス化します。コンソール プラットフォームで検出されたその他のシステムはインデックス化されません。
* Catalog v2 によるデータのインデックス作成は、オンプレミス環境と、Amazon Web Services、Microsoft Azure、Google Cloud Platform (GCP) 環境で行われます。


Indexed Catalog v2 は以下をサポートします。

* 3分以内にグローバル検索を効率化
* 最大50億ファイル
* クラスターあたり最大5000ボリューム
* ボリュームあたり最大10万個のスナップショット
* ベースライン インデックスの最大時間は 7 日未満です。実際の時間は環境によって異なります。


.システムのインデックスカタログを有効にする
Indexed Catalog v2 を使用する場合、サービスでは別のバケットがプロビジョニングされません。代わりに、AWS、Azure、Google Cloud Platform、 StorageGRID、またはONTAP S3 に保存されているバックアップの場合、サービスはコンソール エージェントまたはクラウド プロバイダー環境にスペースをプロビジョニングします。

v2 リリースより前にインデックス カタログを有効にした場合、システムでは次のようになります。

* AWSに保存されているバックアップの場合は、新しいS3バケットをプロビジョニングし、 https://aws.amazon.com/athena/faqs/["Amazon Athena インタラクティブクエリサービス"^]そして https://aws.amazon.com/glue/faqs/["AWS Glue サーバーレスデータ統合サービス"^]。
* Azure に保存されるバックアップの場合、ワークスペース データを保存するコンテナーとして、Azure Synapse ワークスペースと Data Lake ファイル システムがプロビジョニングされます。
* Google Cloudに保存されているバックアップの場合は、新しいバケットがプロビジョニングされ、 https://cloud.google.com/bigquery["Google Cloud BigQuery サービス"^]アカウント/プロジェクト レベルでプロビジョニングされます。
* StorageGRIDまたはONTAP S3 に保存されているバックアップの場合は、コンソール エージェントまたはクラウド プロバイダー環境にスペースをプロビジョニングします。


システムでインデックス作成がすでに有効になっている場合は、次のセクションに進み、データを復元してください。

.システムのインデックス作成を有効にする手順:
. 次のいずれかを実行します。
+
** システムがインデックスされていない場合は、復元ダッシュボードの [_検索と復元_] で [*システムのインデックスを有効にする*] を選択します。
** 少なくとも 1 つのシステムがすでにインデックスされている場合は、復元ダッシュボードの [_検索と復元_] で [*インデックス設定*] を選択します。


. システムに対して*インデックスを有効にする*を選択します。


.結果
すべてのサービスがプロビジョニングされ、インデックス カタログがアクティブ化されると、システムは「アクティブ」として表示されます。

システム内のボリュームのサイズと、3 つのバックアップ場所すべてにあるバックアップ ファイルの数によっては、初期のインデックス作成プロセスに最大 1 時間かかる場合があります。その後は、最新の状態を維持するために、1 時間ごとに段階的な変更が透過的に更新されます。



=== 検索と復元を使用してボリューム、フォルダ、ファイルを復元する

完了したら<<enable-the-indexed-catalog-for-each-working-environment,システムのインデックスを有効にしました>>、検索と復元を使用してボリューム、フォルダー、およびファイルを復元できます。これにより、幅広いフィルターを使用して、すべてのバックアップ ファイルから復元するファイルまたはボリュームを正確に見つけることができます。

.手順
. コンソール メニューから、*保護 > バックアップとリカバリ* を選択します。
. *復元*タブを選択すると、復元ダッシュボードが表示されます。
. [検索と復元] セクションから、[検索と復元] を選択します。
. [検索と復元] セクションから、[検索と復元] を選択します。
. 検索と復元ページから:
+
.. _検索バー_ に、ボリューム名、フォルダー名、またはファイル名の完全または一部を入力します。
.. リソースの種類を選択します: *ボリューム*、*ファイル*、*フォルダー*、または*すべて*。
.. [フィルター条件] 領域で、フィルター条件を選択します。たとえば、データが存在するシステムとファイルの種類（.JPEG ファイルなど）を選択できます。または、オブジェクト ストレージ内の利用可能なスナップショット コピーまたはバックアップ ファイル内のみで結果を検索する場合は、バックアップの場所のタイプを選択できます。


. *検索*を選択すると、検索結果領域に、検索に一致するファイル、フォルダー、またはボリュームを持つすべてのリソースが表示されます。
. 復元するデータがあるリソースを見つけて、[すべてのバックアップを表示] を選択し、一致するボリューム、フォルダー、またはファイルを含むすべてのバックアップ ファイルを表示します。
. データの復元に使用するバックアップ ファイルを見つけて、[復元] を選択します。
+
結果には、検索対象のファイルを含むローカル ボリュームのスナップショット コピーとリモートの複製ボリュームが識別されることに注意してください。クラウド バックアップ ファイル、スナップショット コピー、または複製されたボリュームから復元することを選択できます。

. ボリューム、フォルダー、またはファイルを復元する宛先の場所を選択し、[復元] を選択します。
+
** ボリュームの場合、元の宛先システムを選択することも、代替システムを選択することもできます。  FlexGroupボリュームを復元する場合は、複数のアグリゲートを選択する必要があります。
** フォルダーの場合は、元の場所に復元することも、システム、ボリューム、フォルダーなどの別の場所を選択することもできます。
** ファイルについては、元の場所へ復元することも、システム、ボリューム、フォルダーなどの別の場所を選択することもできます。元の場所を選択するときに、ソース ファイルを上書きするか、新しいファイルを作成するかを選択できます。
+
オンプレミスのONTAPシステムを選択し、オブジェクト ストレージへのクラスタ接続をまだ構成していない場合は、追加情報の入力を求められます。

+
ifdef::aws[]

+
*** Amazon S3 から復元する場合は、宛先ボリュームが存在するONTAPクラスター内の IPspace を選択し、作成したユーザーのアクセス キーとシークレット キーを入力してONTAPクラスターに S3 バケットへのアクセス権を付与し、オプションで安全なデータ転送のためにプライベート VPC エンドポイントを選択します。link:prev-ontap-backup-onprem-aws.html["これらの要件の詳細については、こちらをご覧ください。"]。






endif::aws[]

ifdef::azure[]

* Azure Blob から復元する場合は、宛先ボリュームが存在するONTAPクラスター内の IPspace を選択し、オプションで VNet とサブネットを選択して、安全なデータ転送のためのプライベート エンドポイントを選択します。link:prev-ontap-backup-onprem-azure.html["これらの要件の詳細については、こちらをご覧ください。"]。


endif::azure[]

ifdef::gcp[]

* Google Cloud Storage から復元する場合は、宛先ボリュームが存在するONTAPクラスター内の IPspace と、オブジェクト ストレージにアクセスするためのアクセス キーとシークレット キーを選択します。link:prev-ontap-backup-onprem-gcp.html["これらの要件の詳細については、こちらをご覧ください。"]。


endif::gcp[]

* StorageGRIDから復元する場合は、 StorageGRIDサーバーの FQDN と、 ONTAP がStorageGRIDとの HTTPS 通信に使用するポートを入力し、オブジェクト ストレージにアクセスするために必要なアクセス キーとシークレット キー、および宛先ボリュームが存在するONTAPクラスタ内の IPspace を入力します。link:prev-ontap-backup-onprem-storagegrid.html["これらの要件の詳細については、こちらをご覧ください。"]。
* ONTAP S3 からリストアする場合は、 ONTAP S3 サーバーの FQDN と、 ONTAP がONTAP S3 との HTTPS 通信に使用するポートを入力し、オブジェクト ストレージにアクセスするために必要なアクセス キーとシークレット キー、および宛先ボリュームが存在するONTAPクラスター内の IPspace を選択します。link:prev-ontap-backup-onprem-ontaps3.html["これらの要件の詳細については、こちらをご覧ください。"]。


.結果
ボリューム、フォルダー、またはファイルが復元され、復元ダッシュボードに戻り、復元操作の進行状況を確認できます。また、*ジョブ監視*タブを選択して、復元の進行状況を確認することもできます。見るlink:br-use-monitor-tasks.html["ジョブモニターページ"]。
