---
sidebar: sidebar 
permalink: prev-ontap-protect-journey.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, NetApp Backup and Recovery, Oracle database, Microsoft SQL Server database, SAP HANA database 
summary: NetApp NetApp Backup and Recovery を使用して VMware ワークロードを保護します。 
---
= NetApp のバックアップとリカバリで保護の旅を計画する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
NetApp Backup and Recovery を使用すると、ソース ボリュームのコピーを最大 3 つ作成してデータを保護できます。ボリューム上でこのサービスを有効にするときに選択できるオプションは多数あるため、準備できるように選択内容を確認する必要があります。

[]
====
*注意* NetAppのバックアップとリカバリのワークロードを切り替えるには、link:br-start-switch-ui.html["さまざまなNetAppバックアップおよびリカバリワークロードに切り替える"] 。

====
以下のオプションについて説明します。

* どのような保護機能を使用しますか: スナップショットコピー、複製ボリューム、クラウドへのバックアップ
* どのバックアップアーキテクチャを使用しますか: ボリュームのカスケードバックアップまたはファンアウトバックアップ
* デフォルトのバックアップポリシーを使用しますか、それともカスタムポリシーを作成する必要がありますか
* サービスにクラウドバケットを作成させたいですか、それとも始める前にオブジェクトストレージコンテナを作成したいですか？
* どのコンソール エージェント展開モードを使用していますか (標準、制限、またはプライベート モード)




== どの保護機能を使用するか

使用する機能を選択する前に、各機能の機能と、提供される保護の種類について簡単に説明します。

[cols="20,70"]
|===
| バックアップ タイプ | 説明 


| Snapshot | ソース ボリューム内のボリュームの読み取り専用の特定時点のイメージをスナップショット コピーとして作成します。スナップショット コピーを使用して、個々のファイルを回復したり、ボリュームの内容全体を復元したりできます。 


| レプリケーション | 別のONTAPストレージ システムにデータのセカンダリ コピーを作成し、セカンダリ データを継続的に更新します。データは最新の状態に保たれ、必要なときにいつでも利用できます。 


| クラウド バックアップ | 保護と長期アーカイブの目的でクラウドにデータのバックアップを作成します。必要に応じて、ボリューム、フォルダー、または個々のファイルをバックアップから同じシステムまたは別のシステムに復元できます。 
|===
スナップショットはすべてのバックアップ方法の基礎であり、バックアップおよびリカバリ サービスを使用するために必要です。スナップショット コピーは、ボリュームの読み取り専用の特定時点のイメージです。イメージは、最後のスナップショット コピーが作成されてからファイルに加えられた変更のみを記録するため、最小限のストレージ スペースしか消費せず、パフォーマンスのオーバーヘッドもごくわずかです。ボリューム上に作成されたスナップショット コピーは、図に示すように、複製されたボリュームとバックアップ ファイルをソース ボリュームに加えられた変更と同期させるために使用されます。

image:diagram-321-overview.png["バックアップ ファイルが、スナップショット コピーとしてソース システム上に、セカンダリ ストレージ システム上に複製されたボリュームとして、およびオブジェクト ストレージ内のバックアップ ファイルとしてどのように存在するかを示す図。"]

別のONTAPストレージ システムに複製されたボリュームを作成し、クラウドにファイルをバックアップすることもできます。または、複製されたボリュームまたはバックアップ ファイルのみを作成することもできます。それはあなたの選択です。

要約すると、 ONTAPシステム内のボリュームに対して作成できる有効な保護フローは次のとおりです。

* ソースボリューム -> スナップショットコピー -> 複製ボリューム -> バックアップファイル
* ソースボリューム -> スナップショットコピー -> バックアップファイル
* ソースボリューム -> スナップショットコピー -> 複製ボリューム



NOTE: 複製されたボリュームまたはバックアップ ファイルの最初の作成には、ソース データの完全なコピーが含まれます。これは、_ベースライン転送_ と呼ばれます。後続の転送には、ソース データの差分コピー (スナップショット) のみが含まれます。

*さまざまなバックアップ方法の比較*

次の表は、3 つのバックアップ方法の一般的な比較を示しています。オブジェクト ストレージ スペースは通常、オンプレミスのディスク ストレージよりも安価ですが、クラウドからデータを頻繁に復元する可能性があると予想される場合は、クラウド プロバイダーからの送信料金によって節約額がいくらか減る可能性があります。クラウド内のバックアップ ファイルからデータを復元する必要がある頻度を特定する必要があります。

この基準に加えて、クラウド ストレージでは、DataLock および Ransomware Protection 機能を使用する場合、追加のセキュリティ オプションが提供され、古いバックアップ ファイルにアーカイブ ストレージ クラスを選択することで、さらにコストを節約できます。link:prev-ontap-policy-object-options.html["DataLockとランサムウェア対策およびアーカイブストレージ設定の詳細"] 。

[cols="18,18,22,18,22"]
|===
| バックアップ タイプ | バックアップ速度 | バックアップコスト | 速度を回復する | 復元コスト 


| *スナップショット* | 高 | 低（ディスク容量） | 高 | 低 


| *複製* | 中 | 中（ディスク容量） | 中 | 中規模（ネットワーク） 


| *クラウドバックアップ* | 低 | 低（オブジェクト空間） | 低 | 高額（プロバイダー料金） 
|===


== どのバックアップアーキテクチャを使用するか

複製されたボリュームとバックアップ ファイルの両方を作成する場合、ボリュームをバックアップするためにファンアウト アーキテクチャまたはカスケード アーキテクチャを選択できます。

*ファンアウト* アーキテクチャは、スナップショットのコピーを、宛先ストレージ システムとクラウド内のバックアップ オブジェクトの両方に独立して転送します。

image:diagram-321-fanout-detailed.png["ボリュームのスナップショット コピーを使用して、複製されたボリュームとバックアップ ファイルを作成および更新する方法を示した図。"]

*カスケード* アーキテクチャでは、まずスナップショットのコピーが宛先ストレージ システムに転送され、次にそのシステムがそのコピーをクラウド内のバックアップ オブジェクトに転送します。

image:diagram-321-cascade-detailed.png["ボリュームのスナップショット コピーを使用して、複製されたボリュームとバックアップ ファイルを作成および更新する方法を示した図。"]

*さまざまなアーキテクチャの選択肢の比較*

この表は、ファンアウト アーキテクチャとカスケード アーキテクチャの比較を示します。

[cols="50,50"]
|===
| ファンアウト | カスケード 


| スナップショットのコピーを 2 つの異なるシステムに送信するため、ソース システムのパフォーマンスへの影響はわずかです。 | スナップショットコピーを一度だけ送信するため、ソースストレージシステムのパフォーマンスへの影響が少なくなります。 


| すべてのポリシー、ネットワーク、 ONTAP構成がソースシステム上で実行されるため、セットアップが簡単になります。 | 一部のネットワークとONTAP構成をセカンダリ システムからも実行する必要があります。 
|===


== スナップショット、レプリケーション、バックアップのデフォルトポリシーを使用しますか？

NetAppが提供するデフォルトのポリシーを使用してバックアップを作成することも、カスタム ポリシーを作成することもできます。アクティベーション ウィザードを使用してボリュームのバックアップおよびリカバリ サービスを有効にする場合、デフォルトのポリシーと、システム (Cloud Volumes ONTAPまたはオンプレミスのONTAPシステム) にすでに存在するその他のポリシーから選択できます。既存のポリシーとは異なるポリシーを使用する場合は、アクティベーション ウィザードを開始する前または使用中にポリシーを作成できます。

* デフォルトのスナップショット ポリシーでは、時間別、日次、週次のスナップショット コピーが作成され、時間別 6 個、日次 2 個、週次 2 個のスナップショット コピーが保持されます。
* デフォルトのレプリケーション ポリシーでは、毎日および毎週のスナップショット コピーがレプリケートされ、毎日 7 個のスナップショット コピーと毎週 52 個のスナップショット コピーが保持されます。
* デフォルトのバックアップ ポリシーでは、毎日および毎週のスナップショット コピーが複製され、毎日 7 個のスナップショット コピーと毎週 52 個のスナップショット コピーが保持されます。


レプリケーションまたはバックアップ用のカスタム ポリシーを作成する場合、ポリシー ラベル (「毎日」や「毎週」など) がスナップショット ポリシーに存在するラベルと一致している必要があります。一致していないと、レプリケートされたボリュームとバックアップ ファイルは作成されません。

NetApp Backup and Recovery UI で、スナップショット、レプリケーション、およびオブジェクト ストレージ ポリシーへのバックアップを作成できます。セクションを参照してくださいlink:prev-ontap-backup-manage.html["新しいバックアップポリシーの追加"]詳細については。

NetApp Backup and Recovery を使用してカスタム ポリシーを作成するだけでなく、System Manager またはONTAPコマンド ライン インターフェイス (CLI) を使用することもできます。

* https://docs.netapp.com/us-en/ontap/task_dp_configure_snapshot.html["System ManagerまたはONTAP CLIを使用してスナップショットポリシーを作成します"^]
* https://docs.netapp.com/us-en/ontap/task_dp_create_custom_data_protection_policies.html["System ManagerまたはONTAP CLIを使用してレプリケーションポリシーを作成します。"^]


*注意:* System Manager を使用する場合は、レプリケーション ポリシーのポリシー タイプとして *非同期* を選択し、オブジェクトへのバックアップ ポリシーとして *非同期* と *クラウドへのバックアップ* を選択します。

ここでは、カスタム ポリシーを作成する場合に役立つ可能性のあるONTAP CLI コマンドのサンプルをいくつか示します。  _admin_ vserver（ストレージVM）を `<vserver_name>`これらのコマンドでは。

[cols="30,70"]
|===
| ポリシーの説明 | コマンド 


| シンプルなスナップショットポリシー | `snapshot policy create -policy WeeklySnapshotPolicy -enabled true -schedule1 weekly -count1 10 -vserver ClusterA -snapmirror-label1 weekly` 


| クラウドへのシンプルなバックアップ | `snapmirror policy create -policy <policy_name> -transfer-priority normal -vserver <vserver_name> -create-snapshot-on-source false -type vault`
`snapmirror policy add-rule -policy <policy_name> -vserver <vserver_name> -snapmirror-label <snapmirror_label> -keep` 


| DataLockとランサムウェア対策を備えたクラウドへのバックアップ | `snapmirror policy create -policy CloudBackupService-Enterprise -snapshot-lock-mode enterprise -vserver <vserver_name>`
`snapmirror policy add-rule -policy CloudBackupService-Enterprise -retention-period 30days` 


| アーカイブストレージクラスによるクラウドへのバックアップ | `snapmirror policy create -vserver <vserver_name> -policy <policy_name> -archive-after-days <days> -create-snapshot-on-source false -type vault`
`snapmirror policy add-rule -policy <policy_name> -vserver <vserver_name> -snapmirror-label <snapmirror_label> -keep` 


| 別のストレージシステムへのシンプルなレプリケーション | `snapmirror policy create -policy <policy_name> -type async-mirror -vserver <vserver_name>`
`snapmirror policy add-rule -policy <policy_name> -vserver <vserver_name> -snapmirror-label <snapmirror_label> -keep` 
|===

NOTE: クラウド関係へのバックアップには、ボールト ポリシーのみを使用できます。



== ポリシーはどこに保存されますか?

バックアップ ポリシーは、使用する予定のバックアップ アーキテクチャ (ファンアウトまたはカスケード) に応じて異なる場所に存在します。レプリケーションでは 2 つのONTAPストレージ システムがペアになり、オブジェクトへのバックアップではストレージ プロバイダーが宛先として使用されるため、レプリケーション ポリシーとバックアップ ポリシーは同じ方法で設計されていません。

* スナップショット ポリシーは常にプライマリ ストレージ システムに存在します。
* レプリケーション ポリシーは常にセカンダリ ストレージ システムに存在します。
* オブジェクトへのバックアップ ポリシーは、ソース ボリュームが存在するシステム上に作成されます。これは、ファンアウト構成の場合はプライマリ クラスター、カスケード構成の場合はセカンダリ クラスターです。


これらの違いは表に示されています。

[cols="25,25,25,25"]
|===
| アーキテクチャ | スナップショットポリシー | レプリケーションポリシー | バックアップ ポリシー 


| *ファンアウト* | プライマリ | セカンダリ | プライマリ 


| *カスケード* | プライマリ | セカンダリ | セカンダリ 
|===
したがって、カスケード アーキテクチャを使用するときにカスタム ポリシーを作成する予定の場合は、複製されたボリュームが作成されるセカンダリ システムでオブジェクト ポリシーへのレプリケーションとバックアップを作成する必要があります。ファンアウト アーキテクチャを使用するときにカスタム ポリシーを作成する予定の場合は、複製されたボリュームが作成されるセカンダリ システムにレプリケーション ポリシーを作成し、プライマリ システムにオブジェクト ポリシーへのバックアップを作成する必要があります。

すべてのONTAPシステムに存在するデフォルトのポリシーを使用している場合は、設定は完了です。



== 独自のオブジェクトストレージコンテナを作成しますか？

システムのオブジェクト ストレージにバックアップ ファイルを作成すると、デフォルトでは、バックアップおよびリカバリ サービスによって、構成したオブジェクト ストレージ アカウントにバックアップ ファイル用のコンテナー (バケットまたはストレージ アカウント) が作成されます。  AWS または GCP バケットの名前は、デフォルトで「netapp-backup-<uuid>」になります。  Azure Blob ストレージ アカウントの名前は「netappbackup<uuid>」です。

特定のプレフィックスを使用したり、特別なプロパティを割り当てたりしたい場合は、オブジェクト プロバイダー アカウントでコンテナーを自分で作成できます。独自のコンテナーを作成する場合は、アクティベーション ウィザードを開始する前にコンテナーを作成する必要があります。 NetApp Backup and Recovery では、任意のバケットを使用したり、バケットを共有したりできます。バックアップ アクティベーション ウィザードは、選択したアカウントと資格情報に対してプロビジョニングされたコンテナーを自動的に検出し、使用するコンテナーを選択できるようにします。

バケットは、コンソールから、またはクラウド プロバイダーから作成できます。

* https://docs.netapp.com/us-en/storage-management-s3-storage/task-add-s3-bucket.html["コンソールから Amazon S3 バケットを作成する"^]
* https://docs.netapp.com/us-en/storage-management-blob-storage/task-add-blob-storage.html["コンソールから Azure Blob ストレージ アカウントを作成する"^]
* https://docs.netapp.com/us-en/storage-management-google-cloud-storage/task-add-gcp-bucket.html["コンソールから Google Cloud Storage バケットを作成する"^]


「netapp-backup-xxxxxx」以外のバケットプレフィックスを使用する予定の場合は、コンソールエージェント IAM ロールの S3 権限を変更する必要があります。

*高度なバケット設定*

古いバックアップ ファイルをアーカイブ ストレージに移動する場合、または DataLock と Ransomware 保護を有効にしてバックアップ ファイルをロックし、ランサムウェアの可能性をスキャンする場合は、特定の構成設定でコンテナーを作成する必要があります。

* 現時点では、クラスターでONTAP 9.10.1 以降のソフトウェアを使用している場合、独自のバケット上のアーカイブ ストレージは AWS S3 ストレージでサポートされています。デフォルトでは、バックアップは S3 _Standard_ ストレージ クラスから開始されます。適切なライフサイクル ルールを使用してバケットを作成してください。
+
** 30 日後、バケットの全スコープ内のオブジェクトを S3 _Standard-IA_ に移動します。
** 「smc_push_to_archive: true」タグが付いたオブジェクトを_Glacier Flexible Retrieval_（旧S3 Glacier）に移動します。


* DataLock とランサムウェア保護は、クラスターでONTAP 9.11.1 以降のソフトウェアを使用している場合は AWS ストレージでサポートされ、 ONTAP 9.12.1 以降のソフトウェアを使用している場合は Azure ストレージでサポートされます。
+
** AWS の場合、30 日間の保持期間を使用してバケットでオブジェクト ロックを有効にする必要があります。
** Azure の場合、バージョン レベルの不変性をサポートするストレージ クラスを作成する必要があります。






== どのコンソールエージェント展開モードを使用していますか

すでにコンソールを使用してストレージを管理している場合は、コンソール エージェントがすでにインストールされています。 NetApp Backup and Recovery と同じコンソール エージェントを使用する予定であれば、準備は完了です。別のコンソール エージェントを使用する必要がある場合は、バックアップとリカバリの実装を開始する前にそれをインストールする必要があります。

NetAppコンソールは、ビジネス要件とセキュリティ要件を満たす方法でコンソールを使用できるようにする複数の導入モードを提供します。  _標準モード_ では、コンソール SaaS レイヤーを活用して完全な機能を提供しますが、_制限モード_ と _プライベート モード_ は接続制限のある組織で利用できます。

https://docs.netapp.com/us-en/console-setup-admin/concept-modes.html["NetAppコンソールの導入モードの詳細"^] 。



=== 完全なインターネット接続を備えたサイトのサポート

NetApp Backup and Recovery を完全なインターネット接続 (_標準モード_ または _SaaS モード_ とも呼ばれます) を備えたサイトで使用する場合、コンソールによって管理されるオンプレミスのONTAPまたはCloud Volumes ONTAPシステムに複製されたボリュームを作成でき、サポートされているいずれかのクラウド プロバイダーのオブジェクト ストレージにバックアップ ファイルを作成できます。link:concept-backup-to-cloud.html["サポートされているバックアップ先の完全なリストを参照してください"] 。

有効なコンソール エージェントの場所の一覧については、バックアップ ファイルを作成する予定のクラウド プロバイダーの次のいずれかのバックアップ手順を参照してください。コンソール エージェントを Linux マシンに手動でインストールするか、特定のクラウド プロバイダーに展開する必要があるという制限がいくつかあります。

* link:prev-ontap-backup-cvo-aws.html["Cloud Volumes ONTAPデータを Amazon S3 にバックアップする"]
* link:prev-ontap-backup-cvo-azure.html["Cloud Volumes ONTAPデータを Azure Blob にバックアップする"]
* link:prev-ontap-backup-cvo-gcp.html["Cloud Volumes ONTAPデータを Google Cloud にバックアップする"]
* link:prev-ontap-backup-onprem-aws.html["オンプレミスのONTAPデータを Amazon S3 にバックアップする"]
* link:prev-ontap-backup-onprem-azure.html["オンプレミスのONTAPデータを Azure Blob にバックアップする"]
* link:prev-ontap-backup-onprem-gcp.html["オンプレミスのONTAPデータを Google Cloud にバックアップする"]
* link:prev-ontap-backup-onprem-storagegrid.html["オンプレミスのONTAPデータをStorageGRIDにバックアップする"]
* link:prev-ontap-backup-onprem-ontaps3.html["オンプレミスのONTAPをONTAP S3 にバックアップする"]




=== インターネット接続が制限されているサイトのサポート

NetApp Backup and Recovery は、インターネット接続が制限されているサイト (_制限モード_ とも呼ばれます) でボリューム データをバックアップするために使用できます。この場合、宛先のクラウド リージョンにコンソール エージェントを展開する必要があります。

ifdef::aws[]

* オンプレミスのONTAPシステムまたは AWS 商用リージョンにインストールされたCloud Volumes ONTAPシステムから Amazon S3 にデータをバックアップできます。link:prev-ontap-backup-cvo-aws.html["Cloud Volumes ONTAPデータを Amazon S3 にバックアップする"] 。


endif::aws[]

ifdef::azure[]

* オンプレミスのONTAPシステムまたは Azure 商用リージョンにインストールされたCloud Volumes ONTAPシステムから Azure Blob にデータをバックアップできます。link:prev-ontap-backup-cvo-azure.html["Cloud Volumes ONTAPデータを Azure Blob にバックアップする"] 。


endif::azure[]



=== インターネットに接続できないサイトのサポート

NetApp Backup and Recovery は、インターネット接続のないサイト (_プライベート モード_ または _ダーク_ サイトとも呼ばれます) でボリューム データをバックアップするために使用できます。この場合、同じサイト内の Linux ホストにコンソール エージェントを展開する必要があります。


NOTE: BlueXPプライベート モード (レガシーBlueXPインターフェイス) は通常、インターネット接続がなく、AWS Secret Cloud、AWS Top Secret Cloud、Azure IL6 などの安全なクラウド領域があるオンプレミス環境で使用されます。NetApp は、従来のBlueXPインターフェースを使用してこれらの環境を引き続きサポートします。従来のBlueXPインターフェースのプライベートモードのドキュメントについては、 https://docs.netapp.com/us-en/console-setup-admin/media/BlueXP-Private-Mode-legacy-interface.pdf["BlueXPプライベートモードの PDF ドキュメント"] 。

* ローカルのオンプレミスONTAPシステムからローカルのNetApp StorageGRIDシステムにデータをバックアップできます。link:prev-ontap-backup-onprem-storagegrid.html["オンプレミスのONTAPデータをStorageGRIDにバックアップする"] 。
* ローカルのオンプレミスONTAPシステムから、ローカルのオンプレミスONTAPシステムまたは S3 オブジェクト ストレージ用に構成されたCloud Volumes ONTAPシステムにデータをバックアップできます。link:prev-ontap-backup-onprem-ontaps3.html["オンプレミスのONTAPデータをONTAP S3 にバックアップする"] .ifdef::aws[]


endif::aws[]

ifdef::azure[]

endif::azure[]
