---
sidebar: sidebar 
permalink: prev-ontap-backup-onprem-azure.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, NetApp Backup and Recovery, Oracle database, Microsoft SQL Server database, SAP HANA database 
summary: NetApp NetApp Backup and Recovery を使用して VMware ワークロードを保護します。 
---
= NetApp Backup and Recovery を使用してオンプレミスの ONTAPデータを Azure Blob ストレージにバックアップする
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
NetApp Backup and Recovery でいくつかの手順を完了して、オンプレミスのONTAPシステムからセカンダリ ストレージ システムおよび Azure Blob ストレージへのボリューム データのバックアップを開始します。


NOTE: 「オンプレミスのONTAPシステム」には、 FAS、 AFF、 ONTAP Selectシステムが含まれます。

[]
====
*注意* NetAppのバックアップとリカバリのワークロードを切り替えるには、link:br-start-switch-ui.html["さまざまなNetAppバックアップおよびリカバリワークロードに切り替える"] 。

====


== 接続方法を特定する

オンプレミスのONTAPシステムから Azure Blob へのバックアップを構成するときに使用する 2 つの接続方法のうちどちらを選択します。

* *パブリック接続* - パブリック Azure エンドポイントを使用して、 ONTAPシステムを Azure Blob ストレージに直接接続します。
* *プライベート接続* - VPN または ExpressRoute を使用し、プライベート IP アドレスを使用する VNet プライベート エンドポイント経由でトラフィックをルーティングします。


オプションとして、パブリック接続またはプライベート接続を使用して、複製されたボリュームのセカンダリONTAPシステムに接続することもできます。

次の図は、*パブリック接続*方式と、コンポーネント間で準備する必要がある接続を示しています。オンプレミスにインストールしたコンソール エージェント、または Azure VNet にデプロイしたコンソール エージェントを使用できます。

image:diagram_cloud_backup_onprem_azure_public.png["NetApp Backup and Recovery がパブリック接続を介してクラスター上のボリュームおよびバックアップ ファイルが保存されている Azure Blob ストレージと通信する方法を示す図。"]

次の図は、*プライベート接続*方式と、コンポーネント間で準備する必要がある接続を示しています。オンプレミスにインストールしたコンソール エージェント、または Azure VNet にデプロイしたコンソール エージェントを使用できます。

image:diagram_cloud_backup_onprem_azure_private.png["NetApp Backup and Recovery が、プライベート接続を介してクラスター上のボリュームおよびバックアップ ファイルが保存されている Azure Blob ストレージと通信する方法を示す図。"]



== コンソールエージェントを準備する

コンソール エージェントは、 NetAppコンソール機能のメイン ソフトウェアです。  ONTAPデータをバックアップおよび復元するには、コンソール エージェントが必要です。



=== コンソールエージェントの作成または切り替え

Azure VNet またはオンプレミスにコンソール エージェントが既にデプロイされている場合は、準備は完了です。

そうでない場合は、いずれかの場所にコンソール エージェントを作成し、 ONTAPデータを Azure Blob ストレージにバックアップする必要があります。別のクラウド プロバイダーにデプロイされたコンソール エージェントは使用できません。

* https://docs.netapp.com/us-en/console-setup-admin/concept-connectors.html["コンソールエージェントについて学ぶ"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-connector-azure.html["Azureにコンソールエージェントをインストールする"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-connector-on-prem.html["オンプレミスにコンソールエージェントをインストールする"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-install-restricted-mode.html["Azure Government リージョンにコンソール エージェントをインストールする"^]
+
NetApp Backup and Recovery は、コンソール エージェントがオンプレミスでインストールされている場合ではなく、クラウドに展開されている場合に、Azure Government リージョンでサポートされます。さらに、Azure Marketplace からコンソール エージェントをデプロイする必要があります。コンソール SaaS Web サイトからコンソール エージェントを政府地域に展開することはできません。





=== コンソールエージェントのネットワークを準備する

コンソール エージェントに必要なネットワーク接続があることを確認します。

.手順
. コンソール エージェントがインストールされているネットワークで次の接続が有効になっていることを確認します。
+
** NetApp Backup and RecoveryおよびBlobオブジェクトストレージへのポート443経由のHTTPS接続(https://docs.netapp.com/us-en/console-setup-admin/task-set-up-networking-azure.html#endpoints-contacted-for-day-to-day-operations["エンドポイントのリストを見る"^]）
** ポート443経由のONTAPクラスタ管理LIFへのHTTPS接続
** NetApp のバックアップとリカバリの検索と復元機能が動作するには、コンソール エージェントと Azure Synapse SQL サービス間の通信用にポート 1433 が開いている必要があります。
** Azure および Azure Government の展開には、追加の受信セキュリティ グループ ルールが必要です。見る https://docs.netapp.com/us-en/console-setup-admin/reference-ports-azure.html["Azure のコンソール エージェントのルール"^]詳細については。


. Azure ストレージへの VNet プライベート エンドポイントを有効にします。これは、 ONTAPクラスターから VNet への ExpressRoute または VPN 接続があり、コンソール エージェントと Blob ストレージ間の通信を仮想プライベート ネットワーク (プライベート接続) 内に維持する場合に必要です。




=== コンソールエージェントへの権限を確認または追加する

NetApp Backup and Recovery の検索と復元機能を使用するには、Azure Synapse ワークスペースと Data Lake ストレージ アカウントにアクセスできるように、コンソール エージェントのロールに特定のアクセス許可が必要です。以下の権限を確認し、ポリシーを変更する必要がある場合は手順に従ってください。

.開始する前に
Azure Synapse Analytics リソース プロバイダー (「Microsoft.Synapse」と呼ばれます) をサブスクリプションに登録する必要があります。 https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types#register-resource-provider["このリソースプロバイダーをサブスクリプションに登録する方法をご覧ください"^] 。リソース プロバイダーを登録するには、サブスクリプションの *所有者* または *投稿者* である必要があります。

.手順
. コンソール エージェント仮想マシンに割り当てられたロールを識別します。
+
.. Azure ポータルで、仮想マシン サービスを開きます。
.. コンソール エージェント仮想マシンを選択します。
.. *設定*の下で*ID*を選択します。
.. *Azure ロールの割り当て*を選択します。
.. コンソール エージェント仮想マシンに割り当てられたカスタム ロールをメモします。


. カスタム ロールを更新します。
+
.. Azure ポータルで、Azure サブスクリプションを開きます。
.. *アクセス制御 (IAM) > ロール*を選択します。
.. カスタム ロールの省略記号 (*...*) を選択し、[編集] を選択します。
.. *JSON* を選択し、次の権限を追加します。
+
[%collapsible]
====
[source, json]
----
"Microsoft.Storage/storageAccounts/listkeys/action",
"Microsoft.Storage/storageAccounts/read",
"Microsoft.Storage/storageAccounts/write",
"Microsoft.Storage/storageAccounts/blobServices/containers/read",
"Microsoft.Storage/storageAccounts/listAccountSas/action",
"Microsoft.KeyVault/vaults/read",
"Microsoft.KeyVault/vaults/accessPolicies/write",
"Microsoft.Network/networkInterfaces/read",
"Microsoft.Resources/subscriptions/locations/read",
"Microsoft.Network/virtualNetworks/read",
"Microsoft.Network/virtualNetworks/subnets/read",
"Microsoft.Resources/subscriptions/resourceGroups/read",
"Microsoft.Resources/subscriptions/resourcegroups/resources/read",
"Microsoft.Resources/subscriptions/resourceGroups/write",
"Microsoft.Authorization/locks/*",
"Microsoft.Network/privateEndpoints/write",
"Microsoft.Network/privateEndpoints/read",
"Microsoft.Network/privateDnsZones/virtualNetworkLinks/write",
"Microsoft.Network/virtualNetworks/join/action",
"Microsoft.Network/privateDnsZones/A/write",
"Microsoft.Network/privateDnsZones/read",
"Microsoft.Network/privateDnsZones/virtualNetworkLinks/read",
"Microsoft.Network/networkInterfaces/delete",
"Microsoft.Network/networkSecurityGroups/delete",
"Microsoft.Resources/deployments/delete",
"Microsoft.ManagedIdentity/userAssignedIdentities/assign/action",
"Microsoft.Synapse/workspaces/write",
"Microsoft.Synapse/workspaces/read",
"Microsoft.Synapse/workspaces/delete",
"Microsoft.Synapse/register/action",
"Microsoft.Synapse/checkNameAvailability/action",
"Microsoft.Synapse/workspaces/operationStatuses/read",
"Microsoft.Synapse/workspaces/firewallRules/read",
"Microsoft.Synapse/workspaces/replaceAllIpFirewallRules/action",
"Microsoft.Synapse/workspaces/operationResults/read",
"Microsoft.Synapse/workspaces/privateEndpointConnectionsApproval/action"
----
====
+
https://docs.netapp.com/us-en/console-setup-admin/reference-permissions-azure.html["ポリシーの完全なJSON形式を表示する"^]

.. *確認+更新*を選択し、*更新*を選択します。






== ライセンス要件を確認する

Azure とコンソールの両方のライセンス要件を確認する必要があります。

* クラスターに対してNetApp Backup and Recovery をアクティブ化する前に、Azure の従量課金制 (PAYGO) コンソール マーケットプレイス オファリングをサブスクライブするか、 NetAppからNetApp Backup and Recovery BYOL ライセンスを購入してアクティブ化する必要があります。これらのライセンスはあなたのアカウント用であり、複数のシステムで使用できます。
+
** NetApp Backup and Recovery PAYGOライセンスの場合は、 https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.cloud-manager?tab=Overview["Azure Marketplace からのNetAppコンソールの提供"^] 。  NetApp Backup and Recovery の課金は、このサブスクリプションを通じて行われます。
** NetApp Backup and Recovery BYOL ライセンスの場合、ライセンスの有効期間と容量にわたってサービスを使用できるようにするNetAppからのシリアル番号が必要になります。link:br-start-licensing.html["BYOLライセンスの管理方法を学ぶ"] 。


* バックアップが保存されるオブジェクト ストレージ スペース用の Azure サブスクリプションが必要です。


*サポート対象地域*

Azure Government リージョンを含むすべてのリージョンで、オンプレミス システムから Azure Blob へのバックアップを作成できます。サービスを設定するときに、バックアップを保存するリージョンを指定します。



== ONTAPクラスタを準備する

ソースのオンプレミスONTAPシステムと、セカンダリのオンプレミスONTAPまたはCloud Volumes ONTAPシステムを準備する必要があります。

ONTAPクラスタを準備するには、次の手順を実行します。

* NetAppコンソールでONTAPシステムを検出する
* ONTAPのシステム要件を確認する
* オブジェクトストレージにデータをバックアップするためのONTAPネットワーク要件を確認する
* ボリュームを複製するためのONTAPネットワーク要件を確認する




=== NetAppコンソールでONTAPシステムを検出する

ソースのオンプレミスONTAPシステムとセカンダリのオンプレミスONTAPまたはCloud Volumes ONTAPシステムの両方が、 NetAppコンソールの *システム* ページで利用できる必要があります。

クラスターを追加するには、クラスター管理 IP アドレスと管理者ユーザー アカウントのパスワードを知っておく必要があります。https://docs.netapp.com/us-en/storage-management-ontap-onprem/task-discovering-ontap.html["クラスターの検出方法を学ぶ"^] 。



=== ONTAPのシステム要件を確認する

次のONTAP要件が満たされていることを確認します。

* 最低でもONTAP 9.8、 ONTAP 9.8P13 以降が推奨されます。
* SnapMirrorライセンス (プレミアム バンドルまたはデータ保護バンドルの一部として含まれています)。
+
*注:* NetApp Backup and Recovery を使用する場合、「Hybrid Cloud Bundle」は必要ありません。

+
方法を学ぶ https://docs.netapp.com/us-en/ontap/system-admin/manage-licenses-concept.html["クラスターライセンスを管理する"^]。

* 時間とタイムゾーンは正しく設定されています。方法を学ぶ https://docs.netapp.com/us-en/ontap/system-admin/manage-cluster-time-concept.html["クラスター時間を設定する"^]。
* データをレプリケートする場合は、データをレプリケートする前に、ソース システムとデスティネーション システムで互換性のあるONTAPバージョンが実行されていることを確認する必要があります。
+
https://docs.netapp.com/us-en/ontap/data-protection/compatible-ontap-versions-snapmirror-concept.html["SnapMirror関係に互換性のあるONTAPバージョンを表示する"^] 。





=== オブジェクトストレージにデータをバックアップするためのONTAPネットワーク要件を確認する

オブジェクト ストレージに接続するシステムでは、次の要件を構成する必要があります。

* ファンアウト バックアップ アーキテクチャの場合は、_プライマリ_ システムで次の設定を構成します。
* カスケード バックアップ アーキテクチャの場合は、セカンダリ システムで次の設定を構成します。


次のONTAPクラスタ ネットワーク要件が必要です。

* ONTAPクラスタは、バックアップおよび復元操作のために、クラスタ間 LIF から Azure Blob ストレージへのポート 443 経由の HTTPS 接続を開始します。
+
ONTAP はオブジェクト ストレージとの間でデータの読み取りと書き込みを行います。オブジェクト ストレージは開始することはなく、応答するだけです。

* ONTAP、コンソール エージェントからクラスタ管理 LIF への着信接続が必要です。コンソール エージェントは Azure VNet に配置できます。
* バックアップするボリュームをホストする各ONTAPノードには、クラスタ間 LIF が必要です。  LIF は、 ONTAP がオブジェクト ストレージに接続するために使用する _IPspace_ に関連付ける必要があります。 https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["IPspacesについて詳しくはこちら"^] 。
+
NetApp Backup and Recovery をセットアップするときに、使用する IPspace の入力を求められます。各 LIF が関連付けられている IPspace を選択する必要があります。これは、「デフォルト」の IPspace の場合もあれば、作成したカスタム IPspace の場合もあります。

* ノードおよびクラスタ間 LIF はオブジェクト ストアにアクセスできます。
* ボリュームが配置されているストレージ VM に対して DNS サーバーが構成されています。方法を見る https://docs.netapp.com/us-en/ontap/networking/configure_dns_services_auto.html["SVMのDNSサービスを構成する"^]。
* デフォルトとは異なる IPspace を使用している場合は、オブジェクト ストレージにアクセスするために静的ルートを作成する必要がある場合があります。
* 必要に応じてファイアウォール ルールを更新し、 ONTAPからオブジェクト ストレージへのポート 443 経由のNetApp Backup and Recovery サービス接続と、ストレージ VM から DNS サーバーへのポート 53 (TCP/UDP) 経由の名前解決トラフィックを許可します。




=== ボリュームを複製するためのONTAPネットワーク要件を確認する

NetApp Backup and Recovery を使用してセカンダリONTAPシステムに複製ボリュームを作成する場合は、ソース システムと宛先システムが次のネットワーク要件を満たしていることを確認してください。



==== オンプレミスのONTAPネットワーク要件

* クラスターが社内にある場合は、企業ネットワークからクラウド プロバイダーの仮想ネットワークへの接続が必要です。これは通常、VPN 接続です。
* ONTAPクラスタは、追加のサブネット、ポート、ファイアウォール、およびクラスタの要件を満たす必要があります。
+
Cloud Volumes ONTAPまたはオンプレミス システムにレプリケートできるため、オンプレミスONTAPシステムのピアリング要件を確認してください。 https://docs.netapp.com/us-en/ontap-sm-classic/peering/reference_prerequisites_for_cluster_peering.html["ONTAPドキュメントでクラスタピアリングの前提条件を確認する"^] 。





==== Cloud Volumes ONTAPのネットワーク要件

* インスタンスのセキュリティ グループには、必要な受信ルールと送信ルール (具体的には、ICMP とポート 11104 および 11105 のルール) が含まれている必要があります。これらのルールは、事前定義されたセキュリティ グループに含まれています。




== Azure Blob をバックアップ先として準備する

. アクティベーション ウィザードでは、既定の Microsoft 管理の暗号化キーを使用する代わりに、独自のカスタム管理キーを使用してデータを暗号化することができます。この場合、Azure サブスクリプション、Key Vault 名、およびキーが必要になります。 https://docs.microsoft.com/en-us/azure/storage/common/customer-managed-keys-overview["独自のキーの使い方を学ぶ"^] 。
+
バックアップとリカバリでは、アクセス許可モデルとして _Azure アクセス ポリシー_ がサポートされていることに注意してください。  _Azure ロールベースのアクセス制御_ (Azure RBAC) アクセス許可モデルは現在サポートされていません。

. オンプレミスのデータセンターから VNet へのパブリック インターネット経由のより安全な接続を確立したい場合は、アクティベーション ウィザードで Azure プライベート エンドポイントを構成するオプションがあります。この場合、この接続の VNet とサブネットを知っておく必要があります。 https://docs.microsoft.com/en-us/azure/private-link/private-endpoint-overview["プライベートエンドポイントの使用に関する詳細を参照してください"^] 。




=== Azure Blob ストレージ アカウントを作成する

デフォルトでは、サービスによってストレージ アカウントが作成されます。独自のストレージ アカウントを使用する場合は、バックアップ アクティブ化ウィザードを開始する前にストレージ アカウントを作成し、ウィザードでそれらのストレージ アカウントを選択できます。

link:prev-ontap-protect-journey.html["独自のストレージアカウントの作成について詳しくは、こちらをご覧ください。"] 。



== ONTAPボリューム上のバックアップをアクティブ化する

オンプレミスのシステムからいつでも直接バックアップをアクティブ化できます。

ウィザードに従って、次の主要な手順を実行します。

* <<バックアップしたいボリュームを選択します>>
* <<バックアップ戦略を定義する>>
* <<選択内容を確認する>>


また、<<APIコマンドを表示する>>レビュー ステップでコードをコピーして、将来のシステムのバックアップ アクティベーションを自動化できます。



=== ウィザードを起動する

.手順
. 次のいずれかの方法で、バックアップと回復のアクティブ化ウィザードにアクセスします。
+
** コンソールの *システム* ページで、システムを選択し、右側のパネルのバックアップとリカバリ サービスの横にある *有効化 > バックアップ ボリューム* を選択します。
+
コンソールの [システム] ページにバックアップの Azure 保存先が存在する場合は、 ONTAPクラスターを Azure Blob オブジェクト ストレージにドラッグできます。

** バックアップとリカバリバーで*ボリューム*を選択します。ボリュームタブから*アクション*を選択しますimage:icon-action.png["アクションアイコン"]アイコンをクリックし、単一ボリューム（オブジェクト ストレージへのレプリケーションまたはバックアップがまだ有効になっていない）の [バックアップのアクティブ化]* を選択します。


+
ウィザードの「概要」ページには、ローカル スナップショット、レプリケーション、バックアップなどの保護オプションが表示されます。この手順で 2 番目のオプションを実行した場合、ボリュームが 1 つ選択された状態で「バックアップ戦略の定義」ページが表示されます。

. 次のオプションを続行します。
+
** コンソール エージェントがすでにある場合は、設定は完了です。  *次へ*を選択してください。
** コンソール エージェントがまだない場合は、[*コンソール エージェントの追加*] オプションが表示されます。。 <<コンソールエージェントを準備する>> 。






=== バックアップしたいボリュームを選択します

保護するボリュームを選択します。保護されたボリュームとは、スナップショット ポリシー、レプリケーション ポリシー、オブジェクトへのバックアップ ポリシーの 1 つ以上を持つボリュームです。

FlexVolまたはFlexGroupボリュームを保護することを選択できますが、システムのバックアップをアクティブ化するときにこれらのボリュームを混在して選択することはできません。方法を見るlink:prev-ontap-backup-manage.html["システム内の追加ボリュームのバックアップを有効にする"](FlexVolまたはFlexGroup) 初期ボリュームのバックアップを構成した後。

[NOTE]
====
* 一度に 1 つのFlexGroupボリューム上でのみバックアップをアクティブ化できます。
* 選択するボリュームには同じSnapLock設定が必要です。すべてのボリュームでSnapLock Enterpriseを有効にするか、 SnapLock を無効にする必要があります。


====
.手順
選択したボリュームにすでにスナップショットまたはレプリケーション ポリシーが適用されている場合は、後で選択したポリシーによって既存のポリシーが上書きされることに注意してください。

. 「ボリュームの選択」ページで、保護するボリュームを選択します。
+
** 必要に応じて、行をフィルタリングして、特定のボリューム タイプ、スタイルなどを持つボリュームのみを表示し、選択を容易にします。
** 最初のボリュームを選択したら、すべてのFlexVolボリュームを選択できます (FlexGroupボリュームは一度に 1 つだけ選択できます)。既存のFlexVolボリュームをすべてバックアップするには、まず 1 つのボリュームをチェックし、次にタイトル行のボックスをチェックします。
** 個々のボリュームをバックアップするには、各ボリュームのボックスをオンにします。


. *次へ*を選択します。




=== バックアップ戦略を定義する

バックアップ戦略を定義するには、次のオプションを設定する必要があります。

* ローカルスナップショット、レプリケーション、オブジェクトストレージへのバックアップなど、バックアップオプションのいずれかまたはすべてを使用するかどうか
* アーキテクチャ
* ローカルスナップショットポリシー
* レプリケーションターゲットとポリシー
+

NOTE: 選択したボリュームのスナップショットおよびレプリケーション ポリシーがこの手順で選択したポリシーと異なる場合、既存のポリシーは上書きされます。

* オブジェクト ストレージ情報へのバックアップ (プロバイダー、暗号化、ネットワーク、バックアップ ポリシー、エクスポート オプション)。


.手順
. 「バックアップ戦略の定義」ページで、次のいずれかまたはすべてを選択します。デフォルトでは 3 つすべてが選択されています。
+
** *ローカル スナップショット*: オブジェクト ストレージへのレプリケーションまたはバックアップを実行する場合は、ローカル スナップショットを作成する必要があります。
** *レプリケーション*: 別のONTAPストレージ システムに複製されたボリュームを作成します。
** *バックアップ*: ボリュームをオブジェクト ストレージにバックアップします。


. *アーキテクチャ*: レプリケーションとバックアップを選択した場合は、次のいずれかの情報フローを選択します。
+
** *カスケード*: 情報はプライマリからセカンダリへ、そしてセカンダリからオブジェクト ストレージへ流れます。
** *ファンアウト*: 情報はプライマリからセカンダリへ、そしてプライマリからオブジェクト ストレージへ流れます。
+
これらのアーキテクチャの詳細については、link:prev-ontap-protect-journey.html["保護の旅を計画する"] 。



. *ローカル スナップショット*: 既存のスナップショット ポリシーを選択するか、新しいポリシーを作成します。
+

TIP: スナップショットをアクティブ化する前にカスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
** ポリシーの名前を入力します。
** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
** *作成*を選択します。


. *レプリケーション*: 次のオプションを設定します。
+
** *レプリケーション ターゲット*: 宛先システムと SVM を選択します。必要に応じて、複製先のアグリゲート (複数可) と、複製されたボリューム名に追加されるプレフィックスまたはサフィックスを選択します。
** *レプリケーション ポリシー*: 既存のレプリケーション ポリシーを選択するか、新しいポリシーを作成します。
+

TIP: レプリケーションをアクティブ化する前にカスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
*** ポリシーの名前を入力します。
*** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
*** *作成*を選択します。




. *オブジェクトにバックアップ*: *バックアップ*を選択した場合は、次のオプションを設定します。
+
** *プロバイダー*: *Microsoft Azure* を選択します。
** *プロバイダー設定*: プロバイダーの詳細とバックアップを保存するリージョンを入力します。
+
新しいストレージ アカウントを作成するか、既存のストレージ アカウントを選択します。

+
Blob コンテナーを管理する独自のリソース グループを作成するか、リソース グループの種類とグループを選択します。

+

TIP: バックアップ ファイルが変更されたり削除されたりするのを防ぐには、30 日間の保持期間を使用して不変ストレージが有効になっているストレージ アカウントが作成されていることを確認してください。

+

TIP: さらにコストを最適化するために古いバックアップ ファイルを Azure Archive Storage に階層化する場合は、ストレージ アカウントに適切なライフサイクル ルールがあることを確認してください。

** *暗号化キー*: 新しい Azure ストレージ アカウントを作成した場合は、プロバイダーから提供された暗号化キー情報を入力します。データの暗号化を管理するために、既定の Azure 暗号化キーを使用するか、Azure アカウントから独自のカスタマー管理キーを選択するかを選択します。
+
独自のカスタマー管理キーを使用する場合は、キー コンテナーとキー情報を入力します。



+

NOTE: 既存の Microsoft ストレージ アカウントを選択した場合は、暗号化情報が既に用意されているため、ここで入力する必要はありません。

+
** *ネットワーク*: IPspace を選択し、プライベート エンドポイントを使用するかどうかを選択します。プライベート エンドポイントはデフォルトで無効になっています。
+
... バックアップするボリュームが存在するONTAPクラスタ内の IPspace。この IPspace のクラスタ間 LIF には、アウトバウンド インターネット アクセスが必要です。
... 必要に応じて、以前に構成した Azure プライベート エンドポイントを使用するかどうかを選択します。 https://learn.microsoft.com/en-us/azure/private-link/private-endpoint-overview["Azure プライベート エンドポイントの使用について学習します"^] 。


** *バックアップ ポリシー*: 既存のオブジェクト ストレージ ポリシーへのバックアップを選択するか、新しいポリシーを作成します。
+

TIP: バックアップをアクティブ化する前にカスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
*** ポリシーの名前を入力します。
*** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
*** オブジェクトへのバックアップ ポリシーの場合は、DataLock と Ransomware Resilience の設定を行います。  DataLockとランサムウェア耐性の詳細については、以下を参照してください。link:prev-ontap-policy-object-options.html["オブジェクトへのバックアップポリシー設定"] 。
*** *作成*を選択します。


** *既存のスナップショット コピーをバックアップ コピーとしてオブジェクト ストレージにエクスポートします*: このシステムで選択したバックアップ スケジュール ラベル (たとえば、毎日、毎週など) に一致する、このシステムのボリュームのローカル スナップショット コピーがある場合は、この追加プロンプトが表示されます。このボックスをオンにすると、すべての履歴スナップショットがバックアップ ファイルとしてオブジェクト ストレージにコピーされ、ボリュームの最も完全な保護が確保されます。


. *次へ*を選択します。




=== 選択内容を確認する

ここで選択内容を確認し、必要に応じて調整を行うことができます。

.手順
. 「レビュー」ページで選択内容を確認します。
. オプションで、*スナップショット ポリシー ラベルをレプリケーション ポリシー ラベルおよびバックアップ ポリシー ラベルと自動的に同期する* チェックボックスをオンにします。これにより、レプリケーションおよびバックアップ ポリシーのラベルと一致するラベルを持つスナップショットが作成されます。
. *バックアップの有効化*を選択します。


.結果
NetApp Backup and Recovery はボリュームの初期バックアップを開始します。複製されたボリュームとバックアップ ファイルのベースライン転送には、プライマリ ストレージ システム データの完全なコピーが含まれます。後続の転送には、スナップショット コピーに含まれるプライマリ ストレージ システム データの差分コピーが含まれます。

複製されたボリュームが宛先クラスターに作成され、プライマリ ボリュームと同期されます。

入力したリソース グループに BLOB ストレージ アカウントが作成され、そこにバックアップ ファイルが保存されます。ボリューム バックアップ ダッシュボードが表示され、バックアップの状態を監視できます。

バックアップと復元ジョブのステータスを監視することもできます。link:br-use-monitor-tasks.html["ジョブ監視ページ"^] 。



=== APIコマンドを表示する

バックアップとリカバリのアクティブ化ウィザードで使用される API コマンドを表示し、必要に応じてコピーすることもできます。将来のシステムでバックアップのアクティベーションを自動化するには、これを実行する必要がある場合があります。

.手順
. バックアップとリカバリのアクティブ化ウィザードから、*API リクエストの表示*を選択します。
. コマンドをクリップボードにコピーするには、[コピー] アイコンを選択します。

