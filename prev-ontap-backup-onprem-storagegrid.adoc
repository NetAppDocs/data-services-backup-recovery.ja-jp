---
sidebar: sidebar 
permalink: prev-ontap-backup-onprem-storagegrid.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, NetApp Backup and Recovery, Oracle database, Microsoft SQL Server database, SAP HANA database 
summary: NetApp Backup and Recoveryでいくつかの手順を完了して、オンプレミスのプライマリONTAPシステムからセカンダリ ストレージ システムおよびNetApp StorageGRIDシステムのオブジェクト ストレージへのボリューム データのバックアップを開始します。 
---
= NetApp Backup and Recoveryを使用してオンプレミスのONTAPデータをStorageGRIDにバックアップします。
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
NetApp Backup and Recoveryでいくつかの手順を完了して、オンプレミスのプライマリONTAPシステムからセカンダリ ストレージ システムおよびNetApp StorageGRIDシステムのオブジェクト ストレージへのボリューム データのバックアップを開始します。


NOTE: 「オンプレミスのONTAPシステム」には、 FAS、 AFF、およびONTAP Selectシステムが含まれます。

[]
====
*注意* NetApp Backup and Recoveryのワークロードを切り替えるには、link:br-start-switch-ui.html["さまざまなNetApp Backup and Recoveryワークロードに切り替える"] 。

====


== 接続方法を特定する

次の図は、オンプレミスのONTAPシステムをStorageGRIDにバックアップする場合の各コンポーネントと、それらの間で準備する必要がある接続を示しています。

オプションで、同じオンプレミスの場所にあるセカンダリONTAPシステムに接続してボリュームを複製することもできます。

image:diagram_cloud_backup_onprem_storagegrid.png["NetApp Backup and Recovery が、ソース システムのボリュームおよびバックアップ ファイルが保存されている宛先ストレージと通信する方法を示す図。"]

コンソール エージェントとオンプレミスのONTAPシステムがインターネットにアクセスできないオンプレミスの場所 (「ダーク サイト」) にインストールされている場合、 StorageGRIDシステムは同じオンプレミス データセンターに配置する必要があります。ダーク サイト構成では、古いバックアップ ファイルのパブリック クラウドへのアーカイブはサポートされていません。



== コンソールエージェントを準備する

コンソール エージェントは、コンソール機能のメイン ソフトウェアです。  ONTAPデータをバックアップおよび復元するには、コンソール エージェントが必要です。



=== コンソールエージェントの作成または切り替え

StorageGRIDにデータをバックアップする場合、オンプレミスでコンソール エージェントが使用可能である必要があります。新しいコンソール エージェントをインストールするか、現在選択されているコンソール エージェントがオンプレミスに存在することを確認する必要があります。コンソール エージェントは、インターネットにアクセスできるサイトにも、アクセスできないサイトにもインストールできます。

* https://docs.netapp.com/us-en/console-setup-admin/concept-connectors.html["コンソールエージェントについて学ぶ"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-connector-on-prem.html["インターネットにアクセスできる Linux ホストにコンソール エージェントをインストールする"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-private-mode.html["インターネットにアクセスできない Linux ホストにコンソール エージェントをインストールする"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-manage-multiple-connectors.html#switch-between-connectors["コンソールエージェント間の切り替え"^]




=== コンソールエージェントのネットワーク要件を準備する

コンソール エージェントがインストールされているネットワークで次の接続が有効になっていることを確認します。

* ポート443経由のStorageGRIDゲートウェイノードへのHTTPS接続
* ポート443経由のONTAPクラスタ管理LIFへのHTTPS接続
* NetApp Backup and Recoveryへのポート 443 経由のアウトバウンド インターネット接続 (コンソール エージェントが「ダーク」サイトにインストールされている場合は必要ありません)




==== プライベートモード（ダークサイト）の考慮事項

* NetApp Backup and Recovery機能は、コンソール エージェントに組み込まれています。プライベート モードでインストールされている場合、新しい機能にアクセスするには、コンソール エージェント ソフトウェアを定期的に更新する必要があります。チェックしてくださいlink:whats-new.html["NetApp Backup and Recoveryの新機能"]NetApp Backup and Recovery の各リリースの新機能を確認してください。新しい機能を使用する場合は、次の手順に従ってください。 https://docs.netapp.com/us-en/console-setup-admin/task-upgrade-connector.html["コンソールエージェントソフトウェアをアップグレードする"^] 。
+
オブジェクト ストレージへのバックアップの作成に加えて、スナップショット コピーと複製されたボリュームをスケジュールして作成する機能が含まれるNetApp Backup and Recoveryの新しいバージョンでは、コンソール エージェントのバージョン 3.9.31 以上を使用する必要があります。したがって、すべてのバックアップを管理するには、この最新リリースを入手することをお勧めします。

* SaaS 環境でNetApp Backup and Recovery を使用すると、 NetApp Backup and Recovery の構成データがクラウドにバックアップされます。インターネットにアクセスできないサイトでNetApp Backup and Recoveryを使用する場合、 NetApp Backup and Recovery構成データは、バックアップが保存されているStorageGRIDバケットにバックアップされます。




== ライセンス要件を確認する

クラスターに対してNetApp Backup and Recoveryをアクティブ化する前に、 NetAppからNetApp Backup and Recovery BYOL ライセンスを購入してアクティブ化する必要があります。このライセンスはアカウント用であり、複数のシステムで使用できます。

ライセンスの有効期間と容量にわたってサービスを使用するには、 NetAppからのシリアル番号が必要になります。link:br-start-licensing.html["BYOLライセンスの管理方法を学ぶ"]。


TIP: StorageGRIDにファイルをバックアップする場合、PAYGO ライセンスはサポートされません。



== ONTAPクラスタを準備する

ソースのオンプレミスONTAPシステムと、セカンダリのオンプレミスONTAPまたはCloud Volumes ONTAPシステムを準備する必要があります。

ONTAPクラスタを準備するには、次の手順を実行します。

* NetApp ConsoleでONTAPシステムを検出する
* ONTAPのシステム要件を確認する
* オブジェクトストレージにデータをバックアップするためのONTAPネットワーク要件を確認する
* ボリュームを複製するためのONTAPネットワーク要件を確認する




=== NetApp ConsoleでONTAPシステムを検出する

ソースのオンプレミスONTAPシステムとセカンダリのオンプレミスONTAPまたはCloud Volumes ONTAPシステムの両方が、 NetApp Consoleの*システム* ページで利用できる必要があります。

クラスターを追加するには、クラスター管理 IP アドレスと管理者ユーザー アカウントのパスワードを知っておく必要があります。https://docs.netapp.com/us-en/storage-management-ontap-onprem/task-discovering-ontap.html["クラスターの検出方法を学ぶ"^]。



=== ONTAPのシステム要件を確認する

次のONTAP要件が満たされていることを確認します。

* 最低でもONTAP 9.8、 ONTAP 9.8P13 以降が推奨されます。
* SnapMirrorライセンス (プレミアム バンドルまたはデータ保護バンドルの一部として含まれています)。
+
*注:* NetApp Backup and Recoveryを使用する場合、「Hybrid Cloud Bundle」は必要ありません。

+
方法を学ぶ https://docs.netapp.com/us-en/ontap/system-admin/manage-licenses-concept.html["クラスターライセンスを管理する"^]。

* 時間とタイムゾーンは正しく設定されています。方法を学ぶ https://docs.netapp.com/us-en/ontap/system-admin/manage-cluster-time-concept.html["クラスター時間を設定する"^]。
* データをレプリケートする場合は、データをレプリケートする前に、ソース システムとデスティネーション システムで互換性のあるONTAPバージョンが実行されていることを確認する必要があります。
+
https://docs.netapp.com/us-en/ontap/data-protection/compatible-ontap-versions-snapmirror-concept.html["SnapMirror関係に互換性のあるONTAPバージョンを表示する"^]。





=== オブジェクトストレージにデータをバックアップするためのONTAPネットワーク要件を確認する

オブジェクト ストレージに接続するシステムでは、次の要件を構成する必要があります。

* ファンアウト バックアップ アーキテクチャを使用する場合は、プライマリ ストレージ システムで次の設定を構成する必要があります。
* カスケード バックアップ アーキテクチャを使用する場合は、セカンダリ ストレージ システムで次の設定を構成する必要があります。


次のONTAPクラスタ ネットワーク要件が必要です。

* ONTAPクラスタは、バックアップおよびリストア操作のために、クラスタ間 LIF からStorageGRIDゲートウェイ ノードへのユーザ指定ポートを介して HTTPS 接続を開始します。ポートはバックアップのセットアップ中に構成可能です。
+
ONTAP はオブジェクト ストレージとの間でデータの読み取りと書き込みを行います。オブジェクト ストレージは開始することはなく、応答するだけです。

* ONTAP、コンソール エージェントからクラスタ管理 LIF への着信接続が必要です。コンソール エージェントは社内に常駐する必要があります。
* バックアップするボリュームをホストする各ONTAPノードには、クラスタ間 LIF が必要です。  LIF は、 ONTAP がオブジェクト ストレージに接続するために使用する _IPspace_ に関連付ける必要があります。 https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["IPspacesについて詳しくはこちら"^] 。
+
NetApp Backup and Recoveryをセットアップするときに、使用する IPspace の入力を求められます。各 LIF が関連付けられている IPspace を選択する必要があります。これは、「デフォルト」の IPspace の場合もあれば、作成したカスタム IPspace の場合もあります。

* ノードのクラスタ間 LIF はオブジェクト ストアにアクセスできます (コンソール エージェントが「ダーク」サイトにインストールされている場合は必要ありません)。
* ボリュームが配置されているストレージ VM に対して DNS サーバーが構成されています。方法を見る https://docs.netapp.com/us-en/ontap/networking/configure_dns_services_auto.html["SVMのDNSサービスを構成する"^]。
* デフォルトとは異なる IPspace を使用している場合は、オブジェクト ストレージにアクセスするために静的ルートを作成する必要がある場合があります。
* 必要に応じてファイアウォール ルールを更新し、指定したポート (通常はポート 443) を介してONTAPからオブジェクト ストレージへのNetApp Backup and Recoveryサービス接続と、ポート 53 (TCP/UDP) を介してストレージ VM から DNS サーバーへの名前解決トラフィックを許可します。




=== ボリュームを複製するためのONTAPネットワーク要件を確認する

NetApp Backup and Recoveryを使用してセカンダリONTAPシステムに複製ボリュームを作成する場合は、ソース システムと宛先システムが次のネットワーク要件を満たしていることを確認してください。



==== オンプレミスのONTAPネットワーク要件

* クラスターが社内にある場合は、企業ネットワークからクラウド プロバイダーの仮想ネットワークへの接続が必要です。これは通常、VPN 接続です。
* ONTAPクラスタは、追加のサブネット、ポート、ファイアウォール、およびクラスタの要件を満たす必要があります。
+
Cloud Volumes ONTAPまたはオンプレミス システムにレプリケートできるため、オンプレミスONTAPシステムのピアリング要件を確認してください。 https://docs.netapp.com/us-en/ontap-sm-classic/peering/reference_prerequisites_for_cluster_peering.html["ONTAPドキュメントでクラスタピアリングの前提条件を確認する"^] 。





==== Cloud Volumes ONTAPのネットワーク要件

* インスタンスのセキュリティ グループには、必要な受信ルールと送信ルール (具体的には、ICMP とポート 11104 および 11105 のルール) が含まれている必要があります。これらのルールは、事前定義されたセキュリティ グループに含まれています。




== StorageGRIDをバックアップターゲットとして準備する

StorageGRID は次の要件を満たしている必要があります。参照 https://docs.netapp.com/us-en/storagegrid-117/["StorageGRIDドキュメント"^]詳細についてはこちらをご覧ください。

StorageGRIDのDataLockおよびランサムウェア耐性要件の詳細については、以下を参照してください。link:prev-ontap-policy-object-options.html["オブジェクトへのバックアップポリシーオプション"] 。

サポートされているStorageGRIDバージョン:: StorageGRID 10.3 以降がサポートされています。
+
--
バックアップに DataLock & Ransomware Resilience を使用するには、 StorageGRIDシステムでバージョン 11.6.0.3 以上を実行している必要があります。

古いバックアップをクラウド アーカイブ ストレージに階層化するには、 StorageGRIDシステムでバージョン 11.3 以降を実行している必要があります。さらに、 StorageGRIDシステムがコンソールの *システム* ページで検出される必要があります。

アーカイブ ストレージを使用するには、管理ノードの IP アクセスが必要です。

ゲートウェイ IP アクセスは常に必要です。

--
S3 認証情報:: StorageGRIDストレージへのアクセスを制御するには、S3 テナント アカウントを作成する必要があります。 https://docs.netapp.com/us-en/storagegrid-117/admin/creating-tenant-account.html["詳細についてはStorageGRIDのドキュメントを参照してください。"^] 。
+
--
StorageGRIDへのバックアップを設定すると、バックアップ ウィザードによってテナント アカウントの S3 アクセス キーとシークレット キーの入力が求められます。テナント アカウントにより、NetApp Backup and Recovery は、バックアップの保存に使用されるStorageGRIDバケットを認証してアクセスできるようになります。キーは、 StorageGRID が誰がリクエストを行っているかを認識するために必要です。

これらのアクセス キーは、次の権限を持つユーザーに関連付ける必要があります。

[source, json]
----
"s3:ListAllMyBuckets",
"s3:ListBucket",
"s3:GetObject",
"s3:PutObject",
"s3:DeleteObject",
"s3:CreateBucket"
----
--
オブジェクトのバージョン管理:: オブジェクト ストア バケットでStorageGRIDオブジェクトのバージョン管理を手動で有効にしないでください。




=== 古いバックアップファイルをパブリッククラウドストレージにアーカイブする準備をする

古いバックアップ ファイルをアーカイブ ストレージに階層化することで、必要のないバックアップに安価なストレージ クラスを使用することになり、コストを節約できます。 StorageGRID は、アーカイブ ストレージを提供しないオンプレミス (プライベート クラウド) ソリューションですが、古いバックアップ ファイルをパブリック クラウド アーカイブ ストレージに移動できます。この方法で使用すると、クラウド ストレージに階層化されたデータ、またはクラウド ストレージから復元されたデータは、 StorageGRIDとクラウド ストレージの間で転送されます。このデータ転送にはコンソールは関与しません。

現在のサポートでは、AWS _S3 Glacier_/_S3 Glacier Deep Archive_ または _Azure Archive_ ストレージにバックアップをアーカイブできます。

* ONTAP の要件*

* クラスタではONTAP 9.12.1 以上を使用する必要があります。


* StorageGRID の要件*

* StorageGRIDは 11.4 以上を使用する必要があります。
* StorageGRIDは https://docs.netapp.com/us-en/storage-management-storagegrid/task-discover-storagegrid.html["コンソールで発見され利用可能"^]。


*Amazon S3 の要件*

* アーカイブされたバックアップが保存されるストレージスペース用の Amazon S3 アカウントにサインアップする必要があります。
* バックアップを AWS S3 Glacier または S3 Glacier Deep Archive ストレージに階層化することを選択できます。link:prev-reference-aws-archive-storage-tiers.html["AWS アーカイブ層の詳細"]。
* StorageGRIDはバケットへのフルコントロールアクセス権を持っている必要があります(`s3:*`); ただし、これが不可能な場合は、バケットポリシーでStorageGRIDに次の S3 権限を付与する必要があります。
+
** `s3:AbortMultipartUpload`
** `s3:DeleteObject`
** `s3:GetObject`
** `s3:ListBucket`
** `s3:ListBucketMultipartUploads`
** `s3:ListMultipartUploadParts`
** `s3:PutObject`
** `s3:RestoreObject`




*Azure Blob の要件*

* アーカイブされたバックアップが保存されるストレージ スペースの Azure サブスクリプションにサインアップする必要があります。
* アクティベーション ウィザードを使用すると、既存のリソース グループを使用して、バックアップを保存する BLOB コンテナーを管理したり、新しいリソース グループを作成したりできます。


クラスターのバックアップ ポリシーのアーカイブ設定を定義するときは、クラウド プロバイダーの資格情報を入力し、使用するストレージ クラスを選択します。  NetApp Backup and Recovery は、クラスターのバックアップをアクティブ化するとクラウド バケットを作成します。  AWS および Azure アーカイブ ストレージに必要な情報を以下に示します。

image:screenshot_sg_archive_to_cloud.png["StorageGRIDから AWS S3 または Azure Blob にバックアップ ファイルをアーカイブするために必要な情報のスクリーンショット。"]

選択したアーカイブ ポリシー設定により、 StorageGRIDに情報ライフサイクル管理 (ILM) ポリシーが生成され、設定が「ルール」として追加されます。

* 既存のアクティブな ILM ポリシーがある場合は、データをアーカイブ層に移動するための新しいルールが ILM ポリシーに追加されます。
* 既存の ILM ポリシーが「提案」状態にある場合、新しい ILM ポリシーの作成とアクティブ化はできません。 https://docs.netapp.com/us-en/storagegrid-117/ilm/index.html["StorageGRID ILMポリシーとルールの詳細"^] 。




== ONTAPボリューム上のバックアップをアクティブ化する

オンプレミスのシステムからいつでも直接バックアップをアクティブ化できます。

ウィザードに従って、次の主要な手順を実行します。

* <<バックアップしたいボリュームを選択します>>
* <<バックアップ戦略を定義する>>
* <<選択内容を確認する>>


また、<<APIコマンドを表示する>>レビュー ステップでコードをコピーして、将来のシステムのバックアップ アクティベーションを自動化できます。



=== ウィザードを起動する

.手順
. 次のいずれかの方法で、バックアップと回復のアクティブ化ウィザードにアクセスします。
+
** コンソールの *システム* ページで、システムを選択し、右側のパネルの [バックアップとリカバリ] の横にある *有効化 > バックアップ ボリューム* を選択します。
+
コンソールの [システム] ページにバックアップの保存先がシステムとして存在する場合は、 ONTAPクラスターをオブジェクト ストレージにドラッグできます。

** バックアップとリカバリバーで*ボリューム*を選択します。  [ボリューム] タブで、*アクション (...)* オプションを選択し、単一のボリューム (オブジェクト ストレージへのレプリケーションまたはバックアップがまだ有効になっていないもの) に対して *バックアップのアクティブ化* を選択します。


+
ウィザードの「概要」ページには、ローカル スナップショット、レプリケーション、バックアップなどの保護オプションが表示されます。この手順で 2 番目のオプションを実行した場合、ボリュームが 1 つ選択された状態で「バックアップ戦略の定義」ページが表示されます。

. 次のオプションを続行します。
+
** コンソールエージェントがすでにある場合は、設定は完了です。  *次へ*を選択してください。
** コンソール エージェントがまだない場合は、[*コンソール エージェントの追加*] オプションが表示されます。参照<<コンソールエージェントを準備する>>。






=== バックアップしたいボリュームを選択します

保護するボリュームを選択します。保護されたボリュームとは、スナップショット ポリシー、レプリケーション ポリシー、オブジェクトへのバックアップ ポリシーの 1 つ以上を持つボリュームです。

FlexVolまたはFlexGroupボリュームを保護することを選択できますが、システムのバックアップをアクティブ化するときにこれらのボリュームを混在して選択することはできません。方法を見るlink:prev-ontap-backup-manage.html["システム内の追加ボリュームのバックアップを有効にする"](FlexVolまたはFlexGroup) 初期ボリュームのバックアップを構成した後。

[NOTE]
====
* 一度に 1 つのFlexGroupボリューム上でのみバックアップをアクティブ化できます。
* 選択するボリュームには同じSnapLock設定が必要です。すべてのボリュームでSnapLock Enterpriseを有効にするか、 SnapLock を無効にする必要があります。


====
.手順
選択したボリュームにスナップショットまたはレプリケーション ポリシーがすでに適用されている場合は、後で選択したポリシーによって既存のポリシーが上書きされます。

. 「ボリュームの選択」ページで、保護するボリュームを選択します。
+
** 必要に応じて、行をフィルタリングして、特定のボリューム タイプ、スタイルなどを持つボリュームのみを表示し、選択を容易にします。
** 最初のボリュームを選択したら、すべてのFlexVolボリュームを選択できます (FlexGroupボリュームは一度に 1 つだけ選択できます)。既存のFlexVolボリュームをすべてバックアップするには、まず 1 つのボリュームをチェックし、次にタイトル行のボックスをチェックします。
** 個々のボリュームをバックアップするには、各ボリュームのボックスをオンにします。


. *次へ*を選択します。




=== バックアップ戦略を定義する

バックアップ戦略を定義するには、次のオプションを設定する必要があります。

* ローカルスナップショット、レプリケーション、オブジェクトストレージへのバックアップなど、バックアップオプションのいずれかまたはすべてを使用するかどうか
* アーキテクチャ
* ローカルスナップショットポリシー
* レプリケーションターゲットとポリシー
+

NOTE: 選択したボリュームのスナップショットおよびレプリケーション ポリシーがこの手順で選択したポリシーと異なる場合、既存のポリシーが上書きされます。

* オブジェクト ストレージ情報へのバックアップ (プロバイダー、暗号化、ネットワーク、バックアップ ポリシー、エクスポート オプション)。


.手順
. 「バックアップ戦略の定義」ページで、次のいずれかまたはすべてを選択します。デフォルトでは 3 つすべてが選択されています。
+
** *ローカル スナップショット*: オブジェクト ストレージへのレプリケーションまたはバックアップを実行する場合は、ローカル スナップショットを作成する必要があります。
** *レプリケーション*: 別のONTAPストレージ システムに複製されたボリュームを作成します。
** *バックアップ*: ボリュームをオブジェクト ストレージにバックアップします。


. *アーキテクチャ*: レプリケーションとバックアップの両方を選択した場合は、次のいずれかの情報フローを選択します。
+
** *カスケード*: 情報はプライマリからセカンダリへ流れ、次にセカンダリからオブジェクト ストレージへ流れます。
** *ファンアウト*: 情報はプライマリからセカンダリへ、そしてプライマリからオブジェクト ストレージへ流れます。
+
これらのアーキテクチャの詳細については、link:prev-ontap-protect-journey.html["保護の旅を計画する"] 。



. *ローカル スナップショット*: 既存のスナップショット ポリシーを選択するか、新しいポリシーを作成します。
+

TIP: カスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
** ポリシーの名前を入力します。
** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
** *作成*を選択します。


. *レプリケーション*: 次のオプションを設定します。
+
** *レプリケーション ターゲット*: 宛先システムと SVM を選択します。必要に応じて、複製先のアグリゲート (複数可) と、複製されたボリューム名に追加されるプレフィックスまたはサフィックスを選択します。
** *レプリケーション ポリシー*: 既存のレプリケーション ポリシーを選択するか、新しいレプリケーション ポリシーを作成します。
+

TIP: カスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
*** ポリシーの名前を入力します。
*** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
*** *作成*を選択します。




. *オブジェクトにバックアップ*: *バックアップ*を選択した場合は、次のオプションを設定します。
+
** *プロバイダー*: * StorageGRID*を選択します。
** *プロバイダー設定*: プロバイダー ゲートウェイ ノードの FQDN の詳細、ポート、アクセス キー、およびシークレット キーを入力します。
+
アクセス キーとシークレット キーは、 ONTAPクラスターにバケットへのアクセス権を付与するために作成した IAM ユーザー用です。

** *ネットワーク*: バックアップするボリュームが存在するONTAPクラスター内の IPspace を選択します。この IPspace のクラスタ間 LIF には、アウトバウンド インターネット アクセスが必要です (コンソール エージェントが「ダーク」サイトにインストールされている場合は必要ありません)。
+

TIP: 適切な IPspace を選択すると、 NetApp Backup and Recovery がONTAPからStorageGRIDオブジェクト ストレージへの接続を確立できるようになります。

** *バックアップ ポリシー*: 既存のオブジェクト ストレージへのバックアップ ポリシーを選択するか、新しいポリシーを作成します。
+

TIP: カスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
*** ポリシーの名前を入力します。
*** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
*** オブジェクトへのバックアップ ポリシーの場合は、DataLock と Ransomware Resilience の設定を行います。  DataLockとランサムウェア耐性の詳細については、以下を参照してください。link:prev-ontap-policy-object-options.html["オブジェクトへのバックアップポリシー設定"] 。
+
クラスターでONTAP 9.11.1 以降を使用している場合は、_DataLock と Ransomware Resilience_ を構成することで、バックアップを削除やランサムウェア攻撃から保護することができます。  _DataLock_ はバックアップ ファイルが変更されたり削除されたりするのを防ぎ、_Ransomware Resilience_ はバックアップ ファイルをスキャンして、バックアップ ファイル内のランサムウェア攻撃の証拠を探します。

*** *作成*を選択します。




+
クラスターがONTAP 9.12.1 以上を使用しており、 StorageGRIDシステムがバージョン 11.4 以上を使用している場合は、一定の日数後に古いバックアップをパブ​​リック クラウド アーカイブ層に階層化することを選択できます。現在サポートされているのは、AWS S3 Glacier/S3 Glacier Deep Archive または Azure Archive ストレージ層です。<<古いバックアップファイルをパブリッククラウドストレージにアーカイブする準備をする,この機能を使用するためにシステムを構成する方法をご覧ください>>。

+
** *パブリック クラウドへの階層化バックアップ*: バックアップを階層化するクラウド プロバイダーを選択し、プロバイダーの詳細を入力します。
+
新しいStorageGRIDクラスターを選択または作成します。コンソールが検出できるStorageGRIDクラスタの作成の詳細については、 https://docs.netapp.com/us-en/storagegrid-117/["StorageGRIDドキュメント"^] 。

** *既存のスナップショット コピーをバックアップ コピーとしてオブジェクト ストレージにエクスポートします*: このシステムで選択したバックアップ スケジュール ラベル (たとえば、毎日、毎週など) に一致する、このシステムのボリュームのローカル スナップショット コピーがある場合は、この追加プロンプトが表示されます。このボックスをオンにすると、すべての履歴スナップショットがバックアップ ファイルとしてオブジェクト ストレージにコピーされ、ボリュームの保護が最も完全になります。


. *次へ*を選択します。




=== 選択内容を確認する

ここで選択内容を確認し、必要に応じて調整を行うことができます。

.手順
. 「レビュー」ページで選択内容を確認します。
. オプションで、*スナップショット ポリシー ラベルをレプリケーション ポリシー ラベルおよびバックアップ ポリシー ラベルと自動的に同期する* チェックボックスをオンにします。これにより、レプリケーションおよびバックアップ ポリシーのラベルと一致するラベルを持つスナップショットが作成されます。
. *バックアップの有効化*を選択します。


.結果
NetApp Backup and Recovery はボリュームの初期バックアップを開始します。複製されたボリュームとバックアップ ファイルのベースライン転送には、ソース データの完全なコピーが含まれます。後続の転送には、スナップショット コピーに含まれるプライマリ ストレージ データの差分コピーが含まれます。

複製されたボリュームが宛先クラスターに作成され、プライマリ ストレージ ボリュームと同期されます。

入力した S3 アクセスキーとシークレットキーで示されるサービスアカウントに S3 バケットが作成され、そこにバックアップファイルが保存されます。

ボリューム バックアップ ダッシュボードが表示され、バックアップの状態を監視できます。

バックアップと復元ジョブのステータスを監視することもできます。link:br-use-monitor-tasks.html["ジョブ監視ページ"^] 。



=== APIコマンドを表示する

バックアップとリカバリのアクティブ化ウィザードで使用される API コマンドを表示し、必要に応じてコピーすることもできます。将来のシステムでバックアップのアクティベーションを自動化するには、これを実行する必要がある場合があります。

.手順
. バックアップとリカバリのアクティブ化ウィザードから、*API リクエストの表示*を選択します。
. コマンドをクリップボードにコピーするには、[コピー] アイコンを選択します。

