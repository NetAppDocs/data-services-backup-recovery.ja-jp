---
sidebar: sidebar 
permalink: prev-ontap-backup-onprem-gcp.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, NetApp Backup and Recovery, Oracle database, Microsoft SQL Server database, SAP HANA database 
summary: NetApp NetApp Backup and Recoveryを使用して VMware ワークロードを保護します。 
---
= NetApp Backup and Recoveryを使用してオンプレミスのONTAPデータを Google Cloud Storage にバックアップする
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
NetApp Backup and Recoveryでいくつかの手順を完了して、オンプレミスのプライマリONTAPシステムからセカンダリ ストレージ システムと Google Cloud Storage へのボリューム データのバックアップを開始します。


NOTE: 「オンプレミスのONTAPシステム」には、 FAS、 AFF、およびONTAP Selectシステムが含まれます。

[]
====
*注意* NetApp Backup and Recoveryのワークロードを切り替えるには、link:br-start-switch-ui.html["さまざまなNetApp Backup and Recoveryワークロードに切り替える"] 。

====


== 接続方法を特定する

オンプレミスのONTAPシステムから Google Cloud Storage へのバックアップを構成するときに使用する 2 つの接続方法のうちどちらを選択します。

* *パブリック接続* - パブリック Google エンドポイントを使用して、 ONTAPシステムを Google Cloud Storage に直接接続します。
* *プライベート接続* - VPN または Google Cloud Interconnect を使用して、プライベート IP アドレスを使用するプライベート Google アクセス インターフェース経由でトラフィックをルーティングします。


オプションとして、パブリック接続またはプライベート接続を使用して、複製されたボリュームのセカンダリONTAPシステムに接続することもできます。

次の図は、*パブリック接続*方式と、コンポーネント間で準備する必要がある接続を示しています。コンソール エージェントは、Google Cloud Platform VPC にデプロイする必要があります。

image:diagram_cloud_backup_onprem_gcp_public.png["NetApp Backup and Recovery がパブリック接続を介してクラスタ上のボリュームおよびバックアップ ファイルが保存されている Google Cloud ストレージと通信する方法を示す図。"]

次の図は、*プライベート接続*方式と、コンポーネント間で準備する必要がある接続を示しています。コンソール エージェントは、Google Cloud Platform VPC にデプロイする必要があります。

image:diagram_cloud_backup_onprem_gcp_private.png["NetApp Backup and Recovery がプライベート接続を介してクラスタ上のボリュームおよびバックアップ ファイルが保存されている Google Cloud ストレージと通信する方法を示す図。"]



== コンソールエージェントを準備する

コンソール エージェントは、コンソール機能のメイン ソフトウェアです。  ONTAPデータをバックアップおよび復元するには、コンソール エージェントが必要です。



=== コンソールエージェントの作成または切り替え

Google Cloud Platform VPC にコンソール エージェントがすでにデプロイされている場合は、準備は完了です。

そうでない場合は、その場所にコンソール エージェントを作成して、 ONTAPデータを Google Cloud Storage にバックアップする必要があります。別のクラウド プロバイダーまたはオンプレミスにデプロイされたコンソール エージェントは使用できません。

* https://docs.netapp.com/us-en/console-setup-admin/concept-connectors.html["コンソールエージェントについて学ぶ"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-connector-google.html["GCP にコンソール エージェントをインストールする"^]




== コンソールエージェントのネットワークを準備する

コンソール エージェントに必要なネットワーク接続があることを確認します。

.手順
. コンソール エージェントがインストールされているネットワークで次の接続が有効になっていることを確認します。
+
** NetApp Backup and RecoveryとGoogle Cloudストレージへのポート443経由のHTTPS接続(https://docs.netapp.com/us-en/console-setup-admin/task-set-up-networking-google.html#endpoints-contacted-for-day-to-day-operations["エンドポイントのリストを見る"^]）
** ポート443経由のONTAPクラスタ管理LIFへのHTTPS接続


. コンソール エージェントをデプロイする予定のサブネットで、プライベート Google アクセス (またはプライベート サービス接続) を有効にします。 https://cloud.google.com/vpc/docs/configure-private-google-access["プライベートGoogleアクセス"^]または https://cloud.google.com/vpc/docs/configure-private-service-connect-apis#on-premises["プライベートサービスコネクト"^]ONTAPクラスタから VPC への直接接続があり、コンソール エージェントと Google Cloud Storage 間の通信を仮想プライベート ネットワーク（プライベート接続）内に維持する必要がある場合に必要です。
+
これらのプライベート アクセス オプションを設定するには、Google の指示に従ってください。  DNSサーバーが次のように設定されていることを確認してください。 `www.googleapis.com`そして `storage.googleapis.com`正しい内部 (プライベート) IP アドレスに設定します。





=== コンソールエージェントへの権限を確認または追加する

NetApp Backup and Recovery の「検索と復元」機能を使用するには、Google Cloud BigQuery サービスにアクセスできるように、コンソール エージェントのロールに特定の権限が必要です。以下の権限を確認し、ポリシーを変更する必要がある場合は手順に従ってください。

.手順
. の中で https://console.cloud.google.com["Google Cloud コンソール"^]、*役割*ページに移動します。
. ページ上部のドロップダウン リストを使用して、編集するロールを含むプロジェクトまたは組織を選択します。
. カスタム ロールを選択します。
. ロールの権限を更新するには、「*ロールの編集*」を選択します。
. 次の新しい権限をロールに追加するには、「権限の追加」を選択します。
+
[source, json]
----
bigquery.jobs.get
bigquery.jobs.list
bigquery.jobs.listAll
bigquery.datasets.create
bigquery.datasets.get
bigquery.jobs.create
bigquery.tables.get
bigquery.tables.getData
bigquery.tables.list
bigquery.tables.create
----
. 編集したロールを保存するには、[*更新*] を選択します。




== ライセンス要件を確認する

* クラスタでNetApp Backup and Recoveryを有効にするには、Google の従量課金制（PAYGO）コンソール マーケットプレイス サービスに登録するか、 NetAppからNetApp Backup and Recovery BYOL ライセンスを購入して有効にする必要があります。これらのライセンスはあなたのアカウント用であり、複数のシステムで使用できます。
+
** NetApp Backup and Recovery PAYGOライセンスの場合は、 https://console.cloud.google.com/marketplace/details/netapp-cloudmanager/cloud-manager?supportedpurview=project["Google Marketplace のNetApp Consoleの提供"^] 。  NetApp Backup and Recoveryの課金は、このサブスクリプションを通じて行われます。
** NetApp Backup and Recovery BYOL ライセンスの場合、ライセンスの有効期間と容量にわたってサービスを使用できるようにするNetAppからのシリアル番号が必要になります。link:br-start-licensing.html["BYOLライセンスの管理方法を学ぶ"]。


* バックアップを保存するオブジェクト ストレージ スペース用の Google サブスクリプションが必要です。


*サポート対象地域*

すべてのリージョンでオンプレミス システムから Google Cloud Storage へのバックアップを作成できます。サービスを設定するときに、バックアップを保存するリージョンを指定します。



== ONTAPクラスタを準備する

ソースのオンプレミスONTAPシステムと、セカンダリのオンプレミスONTAPまたはCloud Volumes ONTAPシステムを準備します。

ONTAPクラスタを準備するには、次の手順を実行します。

* NetApp ConsoleでONTAPシステムを検出する
* ONTAPのシステム要件を確認する
* オブジェクトストレージにデータをバックアップするためのONTAPネットワーク要件を確認する
* ボリュームを複製するためのONTAPネットワーク要件を確認する




=== NetApp ConsoleでONTAPシステムを検出する

ソースのオンプレミスONTAPシステムとセカンダリのオンプレミスONTAPまたはCloud Volumes ONTAPシステムの両方が、 NetApp Consoleの*システム* ページで利用できる必要があります。

クラスターを追加するには、クラスター管理 IP アドレスと管理者ユーザー アカウントのパスワードを知っておく必要があります。https://docs.netapp.com/us-en/storage-management-ontap-onprem/task-discovering-ontap.html["クラスターの検出方法を学ぶ"^]。



=== ONTAPのシステム要件を確認する

ONTAPシステムが次の要件を満たしていることを確認してください。

* 最低でもONTAP 9.8、 ONTAP 9.8P13 以降が推奨されます。
* SnapMirrorライセンス (プレミアム バンドルまたはデータ保護バンドルの一部として含まれています)。
+
*注:* NetApp Backup and Recoveryを使用する場合、「Hybrid Cloud Bundle」は必要ありません。

+
方法を学ぶ https://docs.netapp.com/us-en/ontap/system-admin/manage-licenses-concept.html["クラスターライセンスを管理する"^]。

* 時間とタイムゾーンは正しく設定されています。方法を学ぶ https://docs.netapp.com/us-en/ontap/system-admin/manage-cluster-time-concept.html["クラスター時間を設定する"^]。
* データを複製する場合は、ソース システムと宛先システムで互換性のあるONTAPバージョンが実行されていることを確認します。
+
https://docs.netapp.com/us-en/ontap/data-protection/compatible-ontap-versions-snapmirror-concept.html["SnapMirror関係に互換性のあるONTAPバージョンを表示する"^]。





=== オブジェクトストレージにデータをバックアップするためのONTAPネットワーク要件を確認する

オブジェクト ストレージに接続するシステムでは、次の要件を構成する必要があります。

* ファンアウト バックアップ アーキテクチャの場合は、_プライマリ_ システムで次の設定を構成します。
* カスケード バックアップ アーキテクチャの場合は、セカンダリ システムで次の設定を構成します。


次のONTAPクラスタ ネットワーク要件が必要です。

* ONTAPクラスタは、バックアップおよび復元操作のために、クラスタ間 LIF から Google Cloud Storage へのポート 443 経由の HTTPS 接続を開始します。
+
ONTAP はオブジェクト ストレージとの間でデータの読み取りと書き込みを行います。オブジェクト ストレージは開始することはなく、応答するだけです。

* ONTAP、コンソール エージェントからクラスタ管理 LIF への着信接続が必要です。コンソール エージェントは、Google Cloud Platform VPC に配置できます。
* バックアップするボリュームをホストする各ONTAPノードには、クラスタ間 LIF が必要です。  LIF は、 ONTAP がオブジェクト ストレージに接続するために使用する _IPspace_ に関連付ける必要があります。 https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["IPspacesについて詳しくはこちら"^] 。
+
NetApp Backup and Recoveryをセットアップするときに、使用する IPspace の入力を求められます。各 LIF が関連付けられている IPspace を選択する必要があります。これは、「デフォルト」の IPspace の場合もあれば、作成したカスタム IPspace の場合もあります。

* ノードのクラスタ間 LIF はオブジェクト ストアにアクセスできます。
* ボリュームが配置されているストレージ VM に対して DNS サーバーが構成されています。方法を見る https://docs.netapp.com/us-en/ontap/networking/configure_dns_services_auto.html["SVMのDNSサービスを構成する"^]。
+
プライベートGoogleアクセスまたはプライベートサービス接続を使用している場合は、DNSサーバーが次のように設定されていることを確認してください。 `storage.googleapis.com`正しい内部 (プライベート) IP アドレスに設定します。

* デフォルトとは異なる IPspace を使用している場合は、オブジェクト ストレージにアクセスするために静的ルートを作成する必要があることに注意してください。
* 必要に応じてファイアウォール ルールを更新し、 ONTAPからオブジェクト ストレージへのポート 443 経由のNetApp Backup and Recovery接続と、ストレージ VM から DNS サーバーへのポート 53 (TCP/UDP) 経由の名前解決トラフィックを許可します。




=== ボリュームを複製するためのONTAPネットワーク要件を確認する

NetApp Backup and Recoveryを使用してセカンダリONTAPシステムに複製ボリュームを作成する場合は、ソース システムと宛先システムが次のネットワーク要件を満たしていることを確認してください。



==== オンプレミスのONTAPネットワーク要件

* クラスターがオンプレミスにある場合は、企業ネットワークからクラウド プロバイダーの仮想ネットワークへの接続が必要です。これは通常、VPN 接続です。
* ONTAPクラスタは、追加のサブネット、ポート、ファイアウォール、およびクラスタの要件を満たす必要があります。
+
Cloud Volumes ONTAPまたはオンプレミス システムにレプリケートできるため、オンプレミスONTAPシステムのピアリング要件を確認してください。 https://docs.netapp.com/us-en/ontap-sm-classic/peering/reference_prerequisites_for_cluster_peering.html["ONTAPドキュメントでクラスタピアリングの前提条件を確認する"^] 。





==== Cloud Volumes ONTAPのネットワーク要件

* インスタンスのセキュリティ グループには、必要な受信ルールと送信ルール (具体的には、ICMP とポート 11104 および 11105 のルール) が含まれている必要があります。これらのルールは、事前定義されたセキュリティ グループに含まれています。




== Google Cloud Storage をバックアップ先として準備する

Google Cloud Storage をバックアップ ターゲットとして準備するには、次の手順を実行します。

* 権限を設定します。
* (オプション) 独自のバケットを作成します。  (必要に応じて、サービスによってバケットが作成されます。)
* （オプション）データ暗号化用の顧客管理キーを設定する




=== 権限を設定する

カスタム ロールを使用して特定の権限を持つサービス アカウントにストレージ アクセス キーを提供する必要があります。サービス アカウントにより、NetApp Backup and Recovery は、バックアップの保存に使用される Cloud Storage バケットを認証してアクセスできるようになります。Google Cloud Storage が誰がリクエストを行っているかを認識するために、キーが必要になります。

.手順
. の中で https://console.cloud.google.com["Google Cloud コンソール"^]、*役割*ページに移動します。
. https://cloud.google.com/iam/docs/creating-custom-roles#creating_a_custom_role["新しいロールの作成"^]以下の権限を持ちます:
+
[source, json]
----
storage.buckets.create
storage.buckets.delete
storage.buckets.get
storage.buckets.list
storage.buckets.update
storage.buckets.getIamPolicy
storage.multipartUploads.create
storage.objects.create
storage.objects.delete
storage.objects.get
storage.objects.list
storage.objects.update
----
. Google Cloudコンソールでは、 https://console.cloud.google.com/iam-admin/serviceaccounts["サービスアカウントページに移動します"^] 。
. Cloud プロジェクトを選択します。
. *サービス アカウントの作成* を選択し、必要な情報を入力します。
+
.. *サービス アカウントの詳細*: 名前と説明を入力します。
.. *このサービス アカウントにプロジェクトへのアクセスを許可する*: 先ほど作成したカスタム ロールを選択します。
.. *完了*を選択します。


. へ移動 https://console.cloud.google.com/storage/settings["GCP ストレージ設定"^]サービス アカウントのアクセス キーを作成します。
+
.. プロジェクトを選択し、*相互運用性*を選択します。まだ行っていない場合は、[相互運用性アクセスを有効にする] を選択します。
.. *サービス アカウントのアクセス キー* の下で、*サービス アカウントのキーの作成* を選択し、作成したサービス アカウントを選択して、*キーの作成* をクリックします。
+
後でバックアップ サービスを構成するときに、 NetApp Backup and Recoveryにキーを入力する必要があります。







=== 独自のバケットを作成する

デフォルトでは、サービスによってバケットが作成されます。または、独自のバケットを使用する場合は、バックアップ アクティベーション ウィザードを開始する前にバケットを作成し、ウィザードでそれらのバケットを選択できます。

link:prev-ontap-protect-journey.html["独自のバケットの作成について詳しくは"^]。



=== データ暗号化用の顧客管理暗号鍵（CMEK）を設定する

デフォルトの Google 管理の暗号化キーを使用する代わりに、独自の顧客管理キーをデータ暗号化に使用できます。クロスリージョン キーとクロスプロジェクト キーの両方がサポートされているため、CMEK キーのプロジェクトとは異なるバケットのプロジェクトを選択できます。

独自の顧客管理キーを使用する予定の場合:

* アクティベーション ウィザードでこの情報を追加するには、キー リングとキー名が必要です。 https://cloud.google.com/kms/docs/cmek["顧客管理暗号化キーの詳細"^] 。
* コンソール エージェントのロールに次の必要な権限が含まれていることを確認する必要があります。
+
[source, json]
----
cloudkms.cryptoKeys.get
cloudkms.cryptoKeys.getIamPolicy
cloudkms.cryptoKeys.list
cloudkms.cryptoKeys.setIamPolicy
cloudkms.keyRings.get
cloudkms.keyRings.getIamPolicy
cloudkms.keyRings.list
cloudkms.keyRings.setIamPolicy
----
* プロジェクトで Google の「Cloud Key Management Service (KMS)」API が有効になっていることを確認する必要があります。参照 https://cloud.google.com/apis/docs/getting-started#enabling_apis["Google Cloud ドキュメント: API の有効化"^]詳細については。


*CMEKの考慮事項:*

* HSM (ハードウェア バックアップ) キーとソフトウェア生成キーの両方がサポートされています。
* 新しく作成された Cloud KMS キーとインポートされた Cloud KMS キーの両方がサポートされます。
* 地域キーのみがサポートされ、グローバル キーはサポートされません。
* 現在、「対称暗号化/復号化」目的のみがサポートされています。
* ストレージ アカウントに関連付けられたサービス エージェントには、NetApp Backup and Recoveryによって「CryptoKey Encrypter/Decrypter (roles/cloudkms.cryptoKeyEncrypterDecrypter)」IAM ロールが割り当てられます。




== ONTAPボリューム上のバックアップをアクティブ化する

オンプレミスのシステムからいつでも直接バックアップをアクティブ化できます。

ウィザードに従って、次の主要な手順を実行します。

* <<バックアップしたいボリュームを選択します>>
* <<バックアップ戦略を定義する>>
* <<選択内容を確認する>>


また、<<APIコマンドを表示する>>レビュー ステップでコードをコピーして、将来のシステムのバックアップ アクティベーションを自動化できます。



=== ウィザードを起動する

.手順
. 次のいずれかの方法で、バックアップと回復のアクティブ化ウィザードにアクセスします。
+
** コンソールの *システム* ページで、システムを選択し、右側のパネルの [バックアップとリカバリ] の横にある *有効化 > バックアップ ボリューム* を選択します。
+
コンソールの [システム] ページにバックアップの Google Cloud Storage 保存先が存在する場合は、 ONTAPクラスターを Google Cloud オブジェクト ストレージにドラッグできます。

** バックアップとリカバリバーで*ボリューム*を選択します。ボリュームタブから*アクション*を選択しますimage:icon-action.png["アクションアイコン"]アイコンをクリックし、単一ボリューム（オブジェクト ストレージへのレプリケーションまたはバックアップがまだ有効になっていない）の [バックアップのアクティブ化]* を選択します。


+
ウィザードの「概要」ページには、ローカル スナップショット、レプリケーション、バックアップなどの保護オプションが表示されます。この手順で 2 番目のオプションを実行した場合、ボリュームが 1 つ選択された状態で「バックアップ戦略の定義」ページが表示されます。

. 次のオプションを続行します。
+
** コンソールエージェントがすでにある場合は、設定は完了です。  *次へ*を選択してください。
** コンソール エージェントがまだない場合は、[*コンソール エージェントの追加*] オプションが表示されます。参照<<コンソールエージェントを準備する>>。






=== バックアップしたいボリュームを選択します

保護するボリュームを選択します。保護されたボリュームとは、スナップショット ポリシー、レプリケーション ポリシー、オブジェクトへのバックアップ ポリシーの 1 つ以上を持つボリュームです。

FlexVolまたはFlexGroupボリュームを保護することを選択できますが、システムのバックアップをアクティブ化するときにこれらのボリュームを混在して選択することはできません。方法を見るlink:prev-ontap-backup-manage.html["システム内の追加ボリュームのバックアップを有効にする"](FlexVolまたはFlexGroup) 初期ボリュームのバックアップを構成した後。

[NOTE]
====
* 一度に 1 つのFlexGroupボリューム上でのみバックアップをアクティブ化できます。
* 選択するボリュームには同じSnapLock設定が必要です。すべてのボリュームでSnapLock Enterpriseを有効にするか、 SnapLock を無効にする必要があります。


====
.手順
選択したボリュームにスナップショットまたはレプリケーション ポリシーがすでに適用されている場合は、後で選択したポリシーによって既存のポリシーが上書きされます。

. 「ボリュームの選択」ページで、保護するボリュームを選択します。
+
** 必要に応じて、行をフィルタリングして、特定のボリューム タイプ、スタイルなどを持つボリュームのみを表示し、選択を容易にします。
** 最初のボリュームを選択したら、すべてのFlexVolボリュームを選択できます (FlexGroupボリュームは一度に 1 つだけ選択できます)。既存のFlexVolボリュームをすべてバックアップするには、まず 1 つのボリュームをチェックし、次にタイトル行のボックスをチェックします。
** 個々のボリュームをバックアップするには、各ボリュームのボックスをオンにします。


. *次へ*を選択します。




=== バックアップ戦略を定義する

バックアップ戦略を定義するには、次のオプションを設定する必要があります。

* ローカルスナップショット、レプリケーション、オブジェクトストレージへのバックアップなど、バックアップオプションのいずれかまたはすべてが必要な場合
* アーキテクチャ
* ローカルスナップショットポリシー
* レプリケーションターゲットとポリシー
+

NOTE: 選択したボリュームのスナップショットおよびレプリケーション ポリシーがこの手順で選択したポリシーと異なる場合、既存のポリシーが上書きされます。

* オブジェクト ストレージ情報へのバックアップ (プロバイダー、暗号化、ネットワーク、バックアップ ポリシー、エクスポート オプション)。


.手順
. 「バックアップ戦略の定義」ページで、次のいずれかまたはすべてを選択します。デフォルトでは 3 つすべてが選択されています。
+
** *ローカル スナップショット*: オブジェクト ストレージへのレプリケーションまたはバックアップを実行する場合は、ローカル スナップショットを作成する必要があります。
** *レプリケーション*: 別のONTAPストレージ システムに複製されたボリュームを作成します。
** *バックアップ*: ボリュームをオブジェクト ストレージにバックアップします。


. *アーキテクチャ*: レプリケーションとバックアップを選択した場合は、次のいずれかの情報フローを選択します。
+
** *カスケード*: 情報はプライマリからセカンダリへ、そしてセカンダリからオブジェクト ストレージへ流れます。
** *ファンアウト*: 情報はプライマリからセカンダリへ、そしてプライマリからオブジェクト ストレージへ流れます。
+
これらのアーキテクチャの詳細については、link:prev-ontap-protect-journey.html["保護の旅を計画する"] 。



. *ローカル スナップショット*: 既存のスナップショット ポリシーを選択するか、新しいポリシーを作成します。
+

TIP: カスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
** ポリシーの名前を入力します。
** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
** *作成*を選択します。


. *レプリケーション*: 次のオプションを設定します。
+
** *レプリケーション ターゲット*: 宛先システムと SVM を選択します。必要に応じて、複製先のアグリゲート (複数可) と、複製されたボリューム名に追加されるプレフィックスまたはサフィックスを選択します。
** *レプリケーション ポリシー*: 既存のレプリケーション ポリシーを選択するか、新しいポリシーを作成します。
+

TIP: カスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
*** ポリシーの名前を入力します。
*** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
*** *作成*を選択します。




. *オブジェクトにバックアップ*: *バックアップ*を選択した場合は、次のオプションを設定します。
+
** *プロバイダー*: *Google Cloud* を選択します。
** *プロバイダー設定*: プロバイダーの詳細とバックアップを保存するリージョンを入力します。
+
新しいバケットを作成するか、すでに作成したバケットを選択します。

+

TIP: さらにコストを最適化するために古いバックアップ ファイルを Google Cloud Archive ストレージに階層化する場合は、バケットに適切なライフサイクル ルールがあることを確認してください。

+
Google Cloud アクセスキーとシークレットキーを入力します。

** *暗号化キー*: 新しい Google Cloud ストレージ アカウントを作成した場合は、プロバイダーから提供された暗号化キー情報を入力します。データの暗号化を管理するために、デフォルトの Google Cloud 暗号化キーを使用するか、Google Cloud アカウントから独自の顧客管理キーを選択するかを選択します。
+

NOTE: 既存の Google Cloud ストレージ アカウントを選択した場合は、暗号化情報がすでに用意されているため、ここで入力する必要はありません。

+
独自の顧客管理キーを使用する場合は、キーリングとキー名を入力します。 https://cloud.google.com/kms/docs/cmek["顧客管理暗号化キーの詳細"^] 。

** *ネットワーク*: IPspace を選択します。
+
バックアップするボリュームが存在するONTAPクラスタ内の IPspace。この IPspace のクラスタ間 LIF には、アウトバウンド インターネット アクセスが必要です。

** *バックアップ ポリシー*: 既存のオブジェクト ストレージ ポリシーへのバックアップを選択するか、新しいポリシーを作成します。
+

TIP: カスタムポリシーを作成するには、link:br-use-policies-create.html["ポリシーを作成します。"] 。

+
ポリシーを作成するには、[*新しいポリシーの作成*] を選択し、次の操作を行います。

+
*** ポリシーの名前を入力します。
*** 通常は異なる頻度のスケジュールを最大 5 つ選択します。
*** *作成*を選択します。


** *既存のスナップショット コピーをバックアップ コピーとしてオブジェクト ストレージにエクスポートします*: このシステムで選択したバックアップ スケジュール ラベル (たとえば、毎日、毎週など) に一致する、このシステムのボリュームのローカル スナップショット コピーがある場合は、この追加プロンプトが表示されます。このボックスをオンにすると、すべての履歴スナップショットがバックアップ ファイルとしてオブジェクト ストレージにコピーされ、ボリュームの最も完全な保護が確保されます。


. *次へ*を選択します。




=== 選択内容を確認する

ここで選択内容を確認し、必要に応じて調整を行うことができます。

.手順
. 「レビュー」ページで選択内容を確認します。
. オプションで、*スナップショット ポリシー ラベルをレプリケーション ポリシー ラベルおよびバックアップ ポリシー ラベルと自動的に同期する* チェックボックスをオンにします。これにより、レプリケーションおよびバックアップ ポリシーのラベルと一致するラベルを持つスナップショットが作成されます。
. *バックアップの有効化*を選択します。


.結果
NetApp Backup and Recovery はボリュームの初期バックアップの作成を開始します。複製されたボリュームとバックアップ ファイルのベースライン転送には、プライマリ ストレージ システム データの完全なコピーが含まれます。後続の転送には、スナップショット コピーに含まれるプライマリ ストレージ システム データの差分コピーが含まれます。

複製されたボリュームが宛先クラスターに作成され、ソース ボリュームと同期されます。

入力した Google アクセスキーとシークレットキーで示されるサービス アカウントに Google Cloud Storage バケットが自動的に作成され、そこにバックアップ ファイルが保存されます。ボリューム バックアップ ダッシュボードが表示され、バックアップの状態を監視できます。

バックアップと復元ジョブのステータスを監視することもできます。link:br-use-monitor-tasks.html["ジョブ監視ページ"^] 。



=== APIコマンドを表示する

バックアップとリカバリのアクティブ化ウィザードで使用される API コマンドを表示し、必要に応じてコピーすることもできます。将来のシステムでバックアップのアクティベーションを自動化するには、これを実行する必要がある場合があります。

.手順
. バックアップとリカバリのアクティブ化ウィザードから、*API リクエストの表示*を選択します。
. コマンドをクリップボードにコピーするには、[コピー] アイコンを選択します。

